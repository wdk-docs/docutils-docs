

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>reStructuredText语法替代的记录 &mdash; docutils-docs v2019.04.12 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../contents.html" class="icon icon-home"> docutils-docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overviews.html">文档实用程序</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Docutils 项目文档概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release/index.html">版本发布</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc.html">文档实用程序</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst.html">Docutils 的标记语法和解析器组件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">用户文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ref/index.html">参考文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howto/index.html">基本知识</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API文档</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../contents.html">docutils-docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../contents.html">Docs</a> &raquo;</li>
        
      <li>reStructuredText语法替代的记录</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/dev/rst/alternatives.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="a-record-of-restructuredtext-syntax-alternatives">
<h1><a class="toc-backref" href="#id25">reStructuredText语法替代的记录</a><a class="headerlink" href="#a-record-of-restructuredtext-syntax-alternatives" title="永久链接至标题">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>David Goodger</p>
</dd>
<dt class="field-even">Contact</dt>
<dd class="field-even"><p><a class="reference external" href="mailto:docutils-develop&#37;&#52;&#48;lists&#46;sourceforge&#46;net">docutils-develop<span>&#64;</span>lists<span>&#46;</span>sourceforge<span>&#46;</span>net</a></p>
</dd>
<dt class="field-odd">Revision</dt>
<dd class="field-odd"><p>$Revision: 7383 $</p>
</dd>
<dt class="field-even">Date</dt>
<dd class="field-even"><p>$Date: 2012-03-19 18:04:49 +0100 (Mo, 19. M盲r 2012) $</p>
</dd>
<dt class="field-odd">Copyright</dt>
<dd class="field-odd"><p>This document has been placed in the public domain.</p>
</dd>
</dl>
<p>The following are ideas, alternatives, and justifications that were
considered for reStructuredText syntax, which did not originate with
<a class="reference external" href="http://docutils.sourceforge.net/mirror/setext.html">Setext</a> or <a class="reference external" href="http://www.zope.org/DevHome/Members/jim/StructuredTextWiki/FrontPage">StructuredText</a>.  For an analysis of constructs which <em>did</em>
originate with StructuredText or Setext, please see <a class="reference external" href="problems.html">Problems With
StructuredText</a>.  See the <a class="reference external" href="../../ref/rst/restructuredtext.html">reStructuredText Markup Specification</a>
for full details of the established syntax.</p>
<p>The ideas are divided into sections:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#implemented">Implemented</a>: already done.  The issues and alternatives are
recorded here for posterity.</p></li>
<li><p><a class="reference internal" href="#not-implemented">Not Implemented</a>: these ideas won’t be implemented.</p></li>
<li><p><a class="reference internal" href="#tabled">Tabled</a>: these ideas should be revisited in the future.</p></li>
<li><p><a class="reference internal" href="#to-do">To Do</a>: these ideas should be implemented.  They’re just waiting
for a champion to resolve issues and get them done.</p></li>
<li><p><a class="reference internal" href="#or-not-to-do">… Or Not To Do?</a>: possible but questionable.  These probably
won’t be implemented, but you never know.</p></li>
</ul>
<div class="contents topic" id="id1">
<p class="topic-title first">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#a-record-of-restructuredtext-syntax-alternatives" id="id25">reStructuredText语法替代的记录</a></p>
<ul>
<li><p><a class="reference internal" href="#implemented" id="id26">Implemented</a></p>
<ul>
<li><p><a class="reference internal" href="#field-lists" id="id27">Field Lists</a></p></li>
<li><p><a class="reference internal" href="#interpreted-text-roles" id="id28">Interpreted Text “Roles”</a></p></li>
<li><p><a class="reference internal" href="#comments" id="id29">Comments</a></p></li>
<li><p><a class="reference internal" href="#anonymous-hyperlinks" id="id30">Anonymous Hyperlinks</a></p></li>
<li><p><a class="reference internal" href="#reworking-explicit-markup-round-1" id="id31">Reworking Explicit Markup (Round 1)</a></p></li>
<li><p><a class="reference internal" href="#backquotes-in-phrase-links" id="id32">Backquotes in Phrase-Links</a></p></li>
<li><p><a class="reference internal" href="#substitution-mechanism" id="id33">Substitution Mechanism</a></p></li>
<li><p><a class="reference internal" href="#inline-external-targets" id="id34">Inline External Targets</a></p></li>
<li><p><a class="reference internal" href="#doctree-representation-of-transitions" id="id35">Doctree Representation of Transitions</a></p></li>
<li><p><a class="reference internal" href="#syntax-for-line-blocks" id="id36">Syntax for Line Blocks</a></p>
<ul>
<li><p><a class="reference internal" href="#syntax" id="id37">Syntax</a></p></li>
<li><p><a class="reference internal" href="#internal-representation" id="id38">Internal Representation</a></p></li>
<li><p><a class="reference internal" href="#output" id="id39">Output</a></p></li>
<li><p><a class="reference internal" href="#implementation-plan" id="id40">Implementation Plan</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#list-driven-tables" id="id41">List-Driven Tables</a></p></li>
<li><p><a class="reference internal" href="#auto-enumerated-lists" id="id42">Auto-Enumerated Lists</a></p></li>
<li><p><a class="reference internal" href="#adjacent-citation-references" id="id43">Adjacent citation references</a></p></li>
<li><p><a class="reference internal" href="#inline-markup-recognition" id="id44">Inline markup recognition</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#not-implemented" id="id45">Not Implemented</a></p>
<ul>
<li><p><a class="reference internal" href="#reworking-footnotes" id="id46">Reworking Footnotes</a></p></li>
<li><p><a class="reference internal" href="#syntax-for-questions-answers" id="id47">Syntax for Questions &amp; Answers</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tabled" id="id48">Tabled</a></p>
<ul>
<li><p><a class="reference internal" href="#reworking-explicit-markup-round-2" id="id49">Reworking Explicit Markup (Round 2)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#to-do" id="id50">To Do</a></p>
<ul>
<li><p><a class="reference internal" href="#nested-inline-markup" id="id51">Nested Inline Markup</a></p></li>
<li><p><a class="reference internal" href="#index-entries-indexes" id="id52">Index Entries &amp; Indexes</a></p>
<ul>
<li><p><a class="reference internal" href="#from-2002-06-24-docutils-develop-posts" id="id53">from 2002-06-24 docutils-develop posts</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#or-not-to-do" id="id54">… Or Not To Do?</a></p>
<ul>
<li><p><a class="reference internal" href="#compound-enumerated-lists" id="id55">Compound Enumerated Lists</a></p></li>
<li><p><a class="reference internal" href="#indented-lists" id="id56">Indented Lists</a></p></li>
<li><p><a class="reference internal" href="#sloppy-indentation-of-list-items" id="id57">Sloppy Indentation of List Items</a></p></li>
<li><p><a class="reference internal" href="#lazy-indentation-of-list-items" id="id58">Lazy Indentation of List Items</a></p>
<ul>
<li><p><a class="reference internal" href="#david-s-idea-for-lazy-indentation" id="id59">David’s Idea for Lazy Indentation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#multiple-roles-in-interpreted-text" id="id60">Multiple Roles in Interpreted Text</a></p></li>
<li><p><a class="reference internal" href="#parameterized-interpreted-text" id="id61">Parameterized Interpreted Text</a></p></li>
<li><p><a class="reference internal" href="#syntax-for-interpreted-text-role-bindings" id="id62">Syntax for Interpreted Text Role Bindings</a></p></li>
<li><p><a class="reference internal" href="#character-processing" id="id63">Character Processing</a></p></li>
<li><p><a class="reference internal" href="#page-or-line-breaks" id="id64">Page Or Line Breaks</a></p></li>
<li><p><a class="reference internal" href="#superscript-markup" id="id65">Superscript Markup</a></p></li>
<li><p><a class="reference internal" href="#code-execution" id="id66">Code Execution</a></p></li>
<li><p><a class="reference internal" href="#encoding-directive" id="id67"><code class="docutils literal notranslate"><span class="pre">encoding</span></code> Directive</a></p></li>
<li><p><a class="reference internal" href="#support-for-annotations" id="id68">Support for Annotations</a></p></li>
<li><p><a class="reference internal" href="#term-role" id="id69"><code class="docutils literal notranslate"><span class="pre">term</span></code> Role</a></p></li>
<li><p><a class="reference internal" href="#object-references" id="id70">Object references</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="implemented">
<h2><a class="toc-backref" href="#id26">Implemented</a><a class="headerlink" href="#implemented" title="永久链接至标题">¶</a></h2>
<div class="section" id="field-lists">
<h3><a class="toc-backref" href="#id27">Field Lists</a><a class="headerlink" href="#field-lists" title="永久链接至标题">¶</a></h3>
<p>Prior to the syntax for field lists being finalized, several
alternatives were proposed.</p>
<ol class="arabic">
<li><p>Unadorned <a class="reference external" href="http://www.rfc-editor.org/rfc/rfc822.txt">RFC822</a> everywhere:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Author</span><span class="p">:</span> <span class="n">Me</span>
<span class="n">Version</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Advantages: clean, precedent (RFC822-compliant).  Disadvantage:
ambiguous (these paragraphs are a prime example).</p>
<p>Conclusion: rejected.</p>
</li>
<li><p>Special case: use unadorned <a class="reference external" href="http://www.rfc-editor.org/rfc/rfc822.txt">RFC822</a> for the very first or very last
text block of a document:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Author: Me</span>
<span class="sd">Version: 1</span>

<span class="sd">The rest of the document...</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Advantages: clean, precedent (RFC822-compliant).  Disadvantages:
special case, flat (unnested) field lists only, still ambiguous:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Usage: cmdname [options] arg1 arg2 ...</span>

<span class="sd">We obviously *don&#39;t* want the like above to be interpreted as a</span>
<span class="sd">field list item.  Or do we?</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Conclusion: rejected for the general case, accepted for specific
contexts (PEPs, email).</p>
</li>
<li><p>Use a directive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">fields</span><span class="p">::</span>

   <span class="n">Author</span><span class="p">:</span> <span class="n">Me</span>
   <span class="n">Version</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Advantages: explicit and unambiguous, RFC822-compliant.
Disadvantage: cumbersome.</p>
<p>Conclusion: rejected for the general case (but such a directive
could certainly be written).</p>
</li>
<li><p>Use Javadoc-style:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@Author</span><span class="p">:</span> <span class="n">Me</span>
<span class="nd">@Version</span><span class="p">:</span> <span class="mi">1</span>
<span class="nd">@param</span> <span class="n">a</span><span class="p">:</span> <span class="n">integer</span>
</pre></div>
</div>
<p>Advantages: unambiguous, precedent, flexible.  Disadvantages:
non-intuitive, ugly, not RFC822-compliant.</p>
<p>Conclusion: rejected.</p>
</li>
<li><p>Use leading colons:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="n">Author</span><span class="p">:</span> <span class="n">Me</span>
<span class="p">:</span><span class="n">Version</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Advantages: unambiguous, obvious (<em>almost</em> RFC822-compliant),
flexible, perhaps even elegant.  Disadvantages: no precedent, not
quite RFC822-compliant.</p>
<p>Conclusion: accepted!</p>
</li>
<li><p>Use double colons:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Author</span><span class="p">::</span> <span class="n">Me</span>
<span class="n">Version</span><span class="p">::</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Advantages: unambiguous, obvious? (<em>almost</em> RFC822-compliant),
flexible, similar to syntax already used for literal blocks and
directives.  Disadvantages: no precedent, not quite
RFC822-compliant, similar to syntax already used for literal blocks
and directives.</p>
<p>Conclusion: rejected because of the syntax similarity &amp; conflicts.</p>
</li>
</ol>
<p>Why is RFC822 compliance important?  It’s a universal Internet
standard, and super obvious.  Also, I’d like to support the PEP format
(ulterior motive: get PEPs to use reStructuredText as their standard).
But it <em>would</em> be easy to get used to an alternative (easy even to
convert PEPs; probably harder to convert python-deviants ;-).</p>
<p>Unfortunately, without well-defined context (such as in email headers:
RFC822 only applies before any blank lines), the RFC822 format is
ambiguous.  It is very common in ordinary text.  To implement field
lists unambiguously, we need explicit syntax.</p>
<p>The following question was posed in a footnote:</p>
<blockquote>
<div><p>Should “bibliographic field lists” be defined at the parser level,
or at the DPS transformation level?  In other words, are they
reStructuredText-specific, or would they also be applicable to
another (many/every other?) syntax?</p>
</div></blockquote>
<p>The answer is that bibliographic fields are a
reStructuredText-specific markup convention.  Other syntaxes may
implement the bibliographic elements explicitly.  For example, there
would be no need for such a transformation for an XML-based markup
syntax.</p>
</div>
<div class="section" id="interpreted-text-roles">
<h3><a class="toc-backref" href="#id28">Interpreted Text “Roles”</a><a class="headerlink" href="#interpreted-text-roles" title="永久链接至标题">¶</a></h3>
<p>The original purpose of interpreted text was as a mechanism for
descriptive markup, to describe the nature or role of a word or
phrase.  For example, in XML we could say “&lt;function&gt;len&lt;/function&gt;”
to mark up “len” as a function.  It is envisaged that within Python
docstrings (inline documentation in Python module source files, the
primary market for reStructuredText) the role of a piece of
interpreted text can be inferred implicitly from the context of the
docstring within the program source.  For other applications, however,
the role may have to be indicated explicitly.</p>
<p>Interpreted text is enclosed in single backquotes (`).</p>
<ol class="arabic">
<li><p>Initially, it was proposed that an explicit role could be indicated
as a word or phrase within the enclosing backquotes:</p>
<ul>
<li><p>As a prefix, separated by a colon and whitespace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`role: interpreted text`
</pre></div>
</div>
</li>
<li><p>As a suffix, separated by whitespace and a colon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`interpreted text :role`
</pre></div>
</div>
</li>
</ul>
<p>There are problems with the initial approach:</p>
<ul class="simple">
<li><p>There could be ambiguity with interpreted text containing colons.
For example, an index entry of “Mission: Impossible” would
require a backslash-escaped colon.</p></li>
<li><p>The explicit role is descriptive markup, not content, and will
not be visible in the processed output.  Putting it inside the
backquotes doesn’t feel right; the <em>role</em> isn’t being quoted.</p></li>
</ul>
</li>
<li><p>Tony Ibbs suggested that the role be placed outside the
backquotes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>role:`prefix` or `suffix`:role
</pre></div>
</div>
<p>This removes the embedded-colons ambiguity, but limits the role
identifier to be a single word (whitespace would be illegal).
Since roles are not meant to be visible after processing, the lack
of whitespace support is not important.</p>
<p>The suggested syntax remains ambiguous with respect to ratios and
some writing styles.  For example, suppose there is a “signal”
identifier, and we write:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>...calculate the `signal`:noise ratio.
</pre></div>
</div>
<p>“noise” looks like a role.</p>
</li>
<li><p>As an improvement on #2, we can bracket the role with colons:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>:role:`prefix` or `suffix`:role:
</pre></div>
</div>
<p>This syntax is similar to that of field lists, which is fine since
both are doing similar things: describing.</p>
<p>This is the syntax chosen for reStructuredText.</p>
</li>
<li><p>Another alternative is two colons instead of one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>role::`prefix` or `suffix`::role
</pre></div>
</div>
<p>But this is used for analogies (“A:B::C:D”: “A is to B as C is to
D”).</p>
<p>Both alternative #2 and #4 lack delimiters on both sides of the
role, making it difficult to parse (by the reader).</p>
</li>
<li><p>Some kind of bracketing could be used:</p>
<ul>
<li><p>Parentheses:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(role)`prefix` or `suffix`(role)
</pre></div>
</div>
</li>
<li><p>Braces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{role}`prefix` or `suffix`{role}
</pre></div>
</div>
</li>
<li><p>Square brackets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[role]`prefix` or `suffix`[role]
</pre></div>
</div>
</li>
<li><p>Angle brackets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;role&gt;`prefix` or `suffix`&lt;role&gt;
</pre></div>
</div>
<p>(The overlap of *ML tags with angle brackets would be too
confusing and precludes their use.)</p>
</li>
</ul>
</li>
</ol>
<p>Syntax #3 was chosen for reStructuredText.</p>
</div>
<div class="section" id="comments">
<h3><a class="toc-backref" href="#id29">Comments</a><a class="headerlink" href="#comments" title="永久链接至标题">¶</a></h3>
<p>A problem with comments (actually, with all indented constructs) is
that they cannot be followed by an indented block – a block quote –
without swallowing it up.</p>
<p>I thought that perhaps comments should be one-liners only.  But would
this mean that footnotes, hyperlink targets, and directives must then
also be one-liners?  Not a good solution.</p>
<p>Tony Ibbs suggested a “comment” directive.  I added that we could
limit a comment to a single text block, and that a “multi-block
comment” could use “comment-start” and “comment-end” directives.  This
would remove the indentation incompatibility.  A “comment” directive
automatically suggests “footnote” and (hyperlink) “target” directives
as well.  This could go on forever!  Bad choice.</p>
<p>Garth Kidd suggested that an “empty comment”, a “..” explicit markup
start with nothing on the first line (except possibly whitespace) and
a blank line immediately following, could serve as an “unindent”.  An
empty comment does <strong>not</strong> swallow up indented blocks following it,
so block quotes are safe.  “A tiny but practical wart.”  Accepted.</p>
</div>
<div class="section" id="anonymous-hyperlinks">
<h3><a class="toc-backref" href="#id30">Anonymous Hyperlinks</a><a class="headerlink" href="#anonymous-hyperlinks" title="永久链接至标题">¶</a></h3>
<p>Alan Jaffray came up with this idea, along with the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Search the `Python DOC-SIG mailing list archives`{}_.

.. _: http://mail.python.org/pipermail/doc-sig/
</pre></div>
</div>
<p>The idea is sound and useful.  I suggested a “double underscore”
syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Search the `Python DOC-SIG mailing list archives`__.

.. __: http://mail.python.org/pipermail/doc-sig/
</pre></div>
</div>
<p>But perhaps single underscores are okay?  The syntax looks better, but
the hyperlink itself doesn’t explicitly say “anonymous”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Search the `Python DOC-SIG mailing list archives`_.

.. _: http://mail.python.org/pipermail/doc-sig/
</pre></div>
</div>
<p>Mixing anonymous and named hyperlinks becomes confusing.  The order of
targets is not significant for named hyperlinks, but it is for
anonymous hyperlinks:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Hyperlinks</span><span class="p">:</span> <span class="n">anonymous_</span><span class="p">,</span> <span class="n">named_</span><span class="p">,</span> <span class="ow">and</span> <span class="n">another</span> <span class="n">anonymous_</span><span class="o">.</span>

<span class="o">..</span> <span class="n">_named</span><span class="p">:</span> <span class="n">named</span>
<span class="o">..</span> <span class="n">_</span><span class="p">:</span> <span class="n">anonymous1</span>
<span class="o">..</span> <span class="n">_</span><span class="p">:</span> <span class="n">anonymous2</span>
</pre></div>
</div>
<p>Without the extra syntax of double underscores, determining which
hyperlink references are anonymous may be difficult.  We’d have to
check which references don’t have corresponding targets, and match
those up with anonymous targets.  Keeping to a simple consistent
ordering (as with auto-numbered footnotes) seems simplest.</p>
<p>reStructuredText will use the explicit double-underscore syntax for
anonymous hyperlinks.  An alternative (see <a class="reference internal" href="#reworking-explicit-markup-round-1">Reworking Explicit Markup
(Round 1)</a> below) for the somewhat awkward “.. __:” syntax is “__”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">An</span> <span class="n">anonymous__</span> <span class="n">reference</span><span class="o">.</span>

<span class="n">__</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">anonymous</span>
</pre></div>
</div>
</div>
<div class="section" id="reworking-explicit-markup-round-1">
<h3><a class="toc-backref" href="#id31">Reworking Explicit Markup (Round 1)</a><a class="headerlink" href="#reworking-explicit-markup-round-1" title="永久链接至标题">¶</a></h3>
<p>Alan Jaffray came up with the idea of <a class="reference internal" href="#anonymous-hyperlinks">anonymous hyperlinks</a>, added
to reStructuredText.  Subsequently it was asserted that hyperlinks
(especially anonymous hyperlinks) would play an increasingly important
role in reStructuredText documents, and therefore they require a
simpler and more concise syntax.  This prompted a review of the
current and proposed explicit markup syntaxes with regards to
improving usability.</p>
<ol class="arabic">
<li><p>Original syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">_blah</span><span class="p">:</span>                     <span class="n">internal</span> <span class="n">hyperlink</span> <span class="n">target</span>
<span class="o">..</span> <span class="n">_blah</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>    <span class="n">external</span> <span class="n">hyperlink</span> <span class="n">target</span>
<span class="o">..</span> <span class="n">_blah</span><span class="p">:</span> <span class="n">blahblah_</span>           <span class="n">indirect</span> <span class="n">hyperlink</span> <span class="n">target</span>
<span class="o">..</span> <span class="n">__</span><span class="p">:</span>                        <span class="n">anonymous</span> <span class="n">internal</span> <span class="n">target</span>
<span class="o">..</span> <span class="n">__</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>       <span class="n">anonymous</span> <span class="n">external</span> <span class="n">target</span>
<span class="o">..</span> <span class="n">__</span><span class="p">:</span> <span class="n">blahblah_</span>              <span class="n">anonymous</span> <span class="n">indirect</span> <span class="n">target</span>
<span class="o">..</span> <span class="p">[</span><span class="n">blah</span><span class="p">]</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>    <span class="n">footnote</span>
<span class="o">..</span> <span class="n">blah</span><span class="p">::</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>    <span class="n">directive</span>
<span class="o">..</span> <span class="n">blah</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>     <span class="n">comment</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>The comment text was intentionally made to look like a hyperlink
target.</p>
</div>
<p>Origins:</p>
<ul class="simple">
<li><p>Except for the colon (a delimiter necessary to allow for
phrase-links), hyperlink target <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">_blah:</span></code> comes from Setext.</p></li>
<li><p>Comment syntax from Setext.</p></li>
<li><p>Footnote syntax from StructuredText (“named links”).</p></li>
<li><p>Directives and anonymous hyperlinks original to reStructuredText.</p></li>
</ul>
<p>Advantages:</p>
<ul class="simple">
<li><p>Consistent explicit markup indicator: “..”.</p></li>
<li><p>Consistent hyperlink syntax: “.. _” &amp; “:”.</p></li>
</ul>
<p>Disadvantages:</p>
<ul class="simple">
<li><p>Anonymous target markup is awkward: “.. __:”.</p></li>
<li><p>The explicit markup indicator (“..”) is excessively overloaded?</p></li>
<li><p>Comment text is limited (can’t look like a footnote, hyperlink,
or directive).  But this is probably not important.</p></li>
</ul>
</li>
<li><p>Alan Jaffray’s proposed syntax #1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__</span> <span class="n">_blah</span>                      <span class="n">internal</span> <span class="n">hyperlink</span> <span class="n">target</span>
<span class="n">__</span> <span class="n">blah</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>     <span class="n">external</span> <span class="n">hyperlink</span> <span class="n">target</span>
<span class="n">__</span> <span class="n">blah</span><span class="p">:</span> <span class="n">blahblah_</span>            <span class="n">indirect</span> <span class="n">hyperlink</span> <span class="n">target</span>
<span class="n">__</span>                            <span class="n">anonymous</span> <span class="n">internal</span> <span class="n">target</span>
<span class="n">__</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>           <span class="n">anonymous</span> <span class="n">external</span> <span class="n">target</span>
<span class="n">__</span> <span class="n">blahblah_</span>                  <span class="n">anonymous</span> <span class="n">indirect</span> <span class="n">target</span>
<span class="n">__</span> <span class="p">[</span><span class="n">blah</span><span class="p">]</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>    <span class="n">footnote</span>
<span class="o">..</span> <span class="n">blah</span><span class="p">::</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>    <span class="n">directive</span>
<span class="o">..</span> <span class="n">blah</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>     <span class="n">comment</span>
</pre></div>
</div>
<p>The hyperlink-connoted underscores have become first-level syntax.</p>
<p>Advantages:</p>
<ul class="simple">
<li><p>Anonymous targets are simpler.</p></li>
<li><p>All hyperlink targets are one character shorter.</p></li>
</ul>
<p>Disadvantages:</p>
<ul>
<li><p>Inconsistent internal hyperlink targets.  Unlike all other named
hyperlink targets, there’s no colon.  There’s an extra leading
underscore, but we can’t drop it because without it, “blah” looks
like a relative URI.  Unless we restore the colon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__</span> <span class="n">blah</span><span class="p">:</span>                      <span class="n">internal</span> <span class="n">hyperlink</span> <span class="n">target</span>
</pre></div>
</div>
</li>
<li><p>Obtrusive markup?</p></li>
</ul>
</li>
<li><p>Alan Jaffray’s proposed syntax #2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. _blah                      internal hyperlink target
.. blah: http://somewhere     external hyperlink target
.. blah: blahblah_            indirect hyperlink target
..                            anonymous internal target
.. http://somewhere           anonymous external target
.. blahblah_                  anonymous indirect target
.. [blah] http://somewhere    footnote
!! blah: http://somewhere     directive
## blah: http://somewhere     comment
</pre></div>
</div>
<p>Leading underscores have been (almost) replaced by “..”, while
comments and directives have gained their own syntax.</p>
<p>Advantages:</p>
<ul class="simple">
<li><p>Anonymous hyperlinks are simpler.</p></li>
<li><p>Unique syntax for comments.  Connotation of “comment” from
some programming languages (including our favorite).</p></li>
<li><p>Unique syntax for directives.  Connotation of “action!”.</p></li>
</ul>
<p>Disadvantages:</p>
<ul>
<li><p>Inconsistent internal hyperlink targets.  Again, unlike all other
named hyperlink targets, there’s no colon.  There’s a leading
underscore, matching the trailing underscores of references,
which no other hyperlink targets have.  We can’t drop that one
leading underscore though: without it, “blah” looks like a
relative URI.  Again, unless we restore the colon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">blah</span><span class="p">:</span>                      <span class="n">internal</span> <span class="n">hyperlink</span> <span class="n">target</span>
</pre></div>
</div>
</li>
<li><p>All (except for internal) hyperlink targets lack their leading
underscores, losing the “hyperlink” connotation.</p></li>
<li><p>Obtrusive syntax for comments.  Alternatives:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>;; blah: http://somewhere
   (also comment syntax in Lisp &amp; others)
,, blah: http://somewhere
   (&quot;comma comma&quot;: sounds like &quot;comment&quot;!)
</pre></div>
</div>
</li>
<li><p>Iffy syntax for directives.  Alternatives?</p></li>
</ul>
</li>
<li><p>Tony Ibbs’ proposed syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">_blah</span><span class="p">:</span>                     <span class="n">internal</span> <span class="n">hyperlink</span> <span class="n">target</span>
<span class="o">..</span> <span class="n">_blah</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>    <span class="n">external</span> <span class="n">hyperlink</span> <span class="n">target</span>
<span class="o">..</span> <span class="n">_blah</span><span class="p">:</span> <span class="n">blahblah_</span>           <span class="n">indirect</span> <span class="n">hyperlink</span> <span class="n">target</span>
<span class="o">..</span>                            <span class="n">anonymous</span> <span class="n">internal</span> <span class="n">target</span>
<span class="o">..</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>           <span class="n">anonymous</span> <span class="n">external</span> <span class="n">target</span>
<span class="o">..</span> <span class="n">blahblah_</span>                  <span class="n">anonymous</span> <span class="n">indirect</span> <span class="n">target</span>
<span class="o">..</span> <span class="p">[</span><span class="n">blah</span><span class="p">]</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>    <span class="n">footnote</span>
<span class="o">..</span> <span class="n">blah</span><span class="p">::</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>    <span class="n">directive</span>
<span class="o">..</span> <span class="n">blah</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>     <span class="n">comment</span>
</pre></div>
</div>
<p>This is the same as the current syntax, except for anonymous
targets which drop their “__: “.</p>
<p>Advantage:</p>
<ul class="simple">
<li><p>Anonymous targets are simpler.</p></li>
</ul>
<p>Disadvantages:</p>
<ul class="simple">
<li><p>Anonymous targets lack their leading underscores, losing the
“hyperlink” connotation.</p></li>
<li><p>Anonymous targets are almost indistinguishable from comments.
(Better to know “up front”.)</p></li>
</ul>
</li>
<li><p>David Goodger’s proposed syntax: Perhaps going back to one of
Alan’s earlier suggestions might be the best solution.  How about
simply adding “__ ” as a synonym for “.. __: ” in the original
syntax?  These would become equivalent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">__</span><span class="p">:</span>                        <span class="n">anonymous</span> <span class="n">internal</span> <span class="n">target</span>
<span class="o">..</span> <span class="n">__</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>       <span class="n">anonymous</span> <span class="n">external</span> <span class="n">target</span>
<span class="o">..</span> <span class="n">__</span><span class="p">:</span> <span class="n">blahblah_</span>              <span class="n">anonymous</span> <span class="n">indirect</span> <span class="n">target</span>

<span class="n">__</span>                            <span class="n">anonymous</span> <span class="n">internal</span> <span class="n">target</span>
<span class="n">__</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">somewhere</span>           <span class="n">anonymous</span> <span class="n">external</span> <span class="n">target</span>
<span class="n">__</span> <span class="n">blahblah_</span>                  <span class="n">anonymous</span> <span class="n">indirect</span> <span class="n">target</span>
</pre></div>
</div>
</li>
</ol>
<p>Alternative 5 has been adopted.</p>
</div>
<div class="section" id="backquotes-in-phrase-links">
<h3><a class="toc-backref" href="#id32">Backquotes in Phrase-Links</a><a class="headerlink" href="#backquotes-in-phrase-links" title="永久链接至标题">¶</a></h3>
<p>[From a 2001-06-05 Doc-SIG post in reply to questions from Doug
Hellmann.]</p>
<p>The first draft of the spec, posted to the Doc-SIG in November 2000,
used square brackets for phrase-links.  I changed my mind because:</p>
<ol class="arabic simple">
<li><p>In the first draft, I had already decided on single-backquotes for
inline literal text.</p></li>
<li><p>However, I wanted to minimize the necessity for backslash escapes,
for example when quoting Python repr-equivalent syntax that uses
backquotes.</p></li>
<li><p>The processing of identifiers (function/method/attribute/module
etc. names) into hyperlinks is a useful feature.  PyDoc recognizes
identifiers heuristically, but it doesn’t take much imagination to
come up with counter-examples where PyDoc’s heuristics would result
in embarassing failure.  I wanted to do it deterministically, and
that called for syntax.  I called this construct “interpreted
text”.</p></li>
<li><p>Leveraging off the <code class="docutils literal notranslate"><span class="pre">*emphasis*/**strong**</span></code> syntax, lead to the
idea of using double-backquotes as syntax.</p></li>
<li><p>I worked out some rules for inline markup recognition.</p></li>
<li><p>In combination with #5, double backquotes lent themselves to inline
literals, neatly satisfying #2, minimizing backslash escapes.  In
fact, the spec says that no interpretation of any kind is done
within double-backquote inline literal text; backslashes do <em>no</em>
escaping within literal text.</p></li>
<li><p>Single backquotes are then freed up for interpreted text.</p></li>
<li><p>I already had square brackets required for footnote references.</p></li>
<li><p>Since interpreted text will typically turn into hyperlinks, it was
a natural fit to use backquotes as the phrase-quoting syntax for
trailing-underscore hyperlinks.</p></li>
</ol>
<p>The original inspiration for the trailing underscore hyperlink syntax
was Setext.  But for phrases Setext used a very cumbersome
<code class="docutils literal notranslate"><span class="pre">underscores_between_words_like_this_</span></code> syntax.</p>
<p>The underscores can be viewed as if they were right-pointing arrows:
<code class="docutils literal notranslate"><span class="pre">--&gt;</span></code>.  So <code class="docutils literal notranslate"><span class="pre">hyperlink_</span></code> points away from the reference, and
<code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">_hyperlink:</span></code> points toward the target.</p>
</div>
<div class="section" id="substitution-mechanism">
<h3><a class="toc-backref" href="#id33">Substitution Mechanism</a><a class="headerlink" href="#substitution-mechanism" title="永久链接至标题">¶</a></h3>
<p>Substitutions arose out of a Doc-SIG thread begun on 2001-10-28 by
Alan Jaffray, “reStructuredText inline markup”.  It reminded me of a
missing piece of the reStructuredText puzzle, first referred to in my
contribution to “Documentation markup &amp; processing / PEPs” (Doc-SIG
2001-06-21).</p>
<p>Substitutions allow the power and flexibility of directives to be
shared by inline text.  They are a way to allow arbitrarily complex
inline objects, while keeping the details out of the flow of text.
They are the equivalent of SGML/XML’s named entities.  For example, an
inline image (using reference syntax alternative 4d (vertical bars)
and definition alternative 3, the alternatives chosen for inclusion in
the spec):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="o">|</span><span class="n">biohazard</span><span class="o">|</span> <span class="n">symbol</span> <span class="n">must</span> <span class="n">be</span> <span class="n">used</span> <span class="n">on</span> <span class="n">containers</span> <span class="n">used</span> <span class="n">to</span> <span class="n">dispose</span>
<span class="n">of</span> <span class="n">medical</span> <span class="n">waste</span><span class="o">.</span>

<span class="o">..</span> <span class="o">|</span><span class="n">biohazard</span><span class="o">|</span> <span class="n">image</span><span class="p">::</span> <span class="n">biohazard</span><span class="o">.</span><span class="n">png</span>
   <span class="p">[</span><span class="n">height</span><span class="o">=</span><span class="mi">20</span> <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">|biohazard|</span></code> substitution reference will be replaced in-line by
whatever the <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">|biohazard|</span></code> substitution definition generates (in
this case, an image).  A substitution definition contains the
substitution text bracketed with vertical bars, followed by a an
embedded inline-compatible directive, such as “image”.  A transform is
required to complete the substitution.</p>
<p>Syntax alternatives for the reference:</p>
<ol class="arabic">
<li><p>Use the existing interpreted text syntax, with a predefined role
such as “sub”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The `biohazard`:sub: symbol...
</pre></div>
</div>
<p>Advantages: existing syntax, explicit.  Disadvantages: verbose,
obtrusive.</p>
</li>
<li><p>Use a variant of the interpreted text syntax, with a new suffix
akin to the underscore in phrase-link references:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(a) `name`@
(b) `name`#
(c) `name`&amp;
(d) `name`/
(e) `name`&lt;
(f) `name`::
(g) `name`:
</pre></div>
</div>
<p>Due to incompatibility with other constructs and ordinary text
usage, (f) and (g) are not possible.</p>
</li>
<li><p>Use interpreted text syntax with a fixed internal format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(a) `:name:`
(b) `name:`
(c) `name::`
(d) `::name::`
(e) `%name%`
(f) `#name#`
(g) `/name/`
(h) `&amp;name&amp;`
(i) `|name|`
(j) `[name]`
(k) `&lt;name&gt;`
(l) `&amp;name;`
(m) `&#39;name&#39;`
</pre></div>
</div>
<p>To avoid ML confusion (k) and (l) are definitely out.  Square
brackets (j) won’t work in the target (the substitution definition
would be indistinguishable from a footnote).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">`/name/`</span></code> syntax (g) is reminiscent of “s/find/sub”
substitution syntax in ed-like languages.  However, it may have a
misleading association with regexps, and looks like an absolute
POSIX path.  (i) is visually equivalent and lacking the
connotations.</p>
<p>A disadvantage of all of these is that they limit interpreted text,
albeit only slightly.</p>
</li>
<li><p>Use specialized syntax, something new:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(a) #name#
(b) @name@
(c) /name/
(d) |name|
(e) &lt;&lt;name&gt;&gt;
(f) //name//
(g) ||name||
(h) ^name^
(i) [[name]]
(j) ~name~
(k) !name!
(l) =name=
(m) ?name?
(n) &gt;name&lt;
</pre></div>
</div>
<p>“#” (a) and “&#64;” (b) are obtrusive.  “/” (c) without backquotes
looks just like a POSIX path; it is likely for such usage to appear
in text.</p>
<p>“|” (d) and “^” (h) are feasible.</p>
</li>
<li><p>Redefine the trailing underscore syntax.  See definition syntax
alternative 4, below.</p></li>
</ol>
<p>Syntax alternatives for the definition:</p>
<ol class="arabic">
<li><p>Use the existing directive syntax, with a predefined directive such
as “sub”.  It contains a further embedded directive resolving to an
inline-compatible object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. sub:: biohazard
   .. image:: biohazard.png
      [height=20 width=20]

.. sub:: parrot
   That bird wouldn&#39;t *voom* if you put 10,000,000 volts
   through it!
</pre></div>
</div>
<p>The advantages and disadvantages are the same as in inline
alternative 1.</p>
</li>
<li><p>Use syntax as in #1, but with an embedded directivecompressed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">sub</span><span class="p">::</span> <span class="n">biohazard</span> <span class="n">image</span><span class="p">::</span> <span class="n">biohazard</span><span class="o">.</span><span class="n">png</span>
   <span class="p">[</span><span class="n">height</span><span class="o">=</span><span class="mi">20</span> <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
<p>This is a bit better than alternative 1, but still too much.</p>
</li>
<li><p>Use a variant of directive syntax, incorporating the substitution
text, obviating the need for a special “sub” directive name.  If we
assume reference alternative 4d (vertical bars), the matching
definition would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="o">|</span><span class="n">biohazard</span><span class="o">|</span> <span class="n">image</span><span class="p">::</span> <span class="n">biohazard</span><span class="o">.</span><span class="n">png</span>
   <span class="p">[</span><span class="n">height</span><span class="o">=</span><span class="mi">20</span> <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>(Suggested by Alan Jaffray on Doc-SIG from 2001-11-06.)</p>
<p>Instead of adding new syntax, redefine the trailing underscore
syntax to mean “substitution reference” instead of “hyperlink
reference”.  Alan’s example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span> <span class="n">had</span> <span class="n">lunch</span> <span class="k">with</span> <span class="n">Jonathan_</span> <span class="n">today</span><span class="o">.</span>  <span class="n">We</span> <span class="n">talked</span> <span class="n">about</span> <span class="n">Zope_</span><span class="o">.</span>

<span class="o">..</span> <span class="n">_Jonathan</span><span class="p">:</span> <span class="n">lj</span> <span class="p">[</span><span class="n">user</span><span class="o">=</span><span class="n">jhl</span><span class="p">]</span>
<span class="o">..</span> <span class="n">_Zope</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">zope</span><span class="o">.</span><span class="n">org</span><span class="o">/</span>
</pre></div>
</div>
<p>A problem with the proposed syntax is that URIs which look like
simple reference names (alphanum plus “.”, “-“, “_”) would be
indistinguishable from substitution directive names.  A more
consistent syntax would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span> <span class="n">had</span> <span class="n">lunch</span> <span class="k">with</span> <span class="n">Jonathan_</span> <span class="n">today</span><span class="o">.</span>  <span class="n">We</span> <span class="n">talked</span> <span class="n">about</span> <span class="n">Zope_</span><span class="o">.</span>

<span class="o">..</span> <span class="n">_Jonathan</span><span class="p">:</span> <span class="n">lj</span><span class="p">::</span> <span class="n">user</span><span class="o">=</span><span class="n">jhl</span>
<span class="o">..</span> <span class="n">_Zope</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">zope</span><span class="o">.</span><span class="n">org</span><span class="o">/</span>
</pre></div>
</div>
<p>(<code class="docutils literal notranslate"><span class="pre">::</span></code> after <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">_Jonathan:</span> <span class="pre">lj</span></code>.)</p>
<p>The “Zope” target is a simple external hyperlink, but the
“Jonathan” target contains a directive.  Alan proposed is that the
reference text be replaced by whatever the referenced directive
(the “directive target”) produces.  A directive reference becomes a
hyperlink reference if the contents of the directive target resolve
to a hyperlink.  If the directive target resolves to an icon, the
reference is replaced by an inline icon.  If the directive target
resolves to a hyperlink, the directive reference becomes a
hyperlink reference.</p>
<p>This seems too indirect and complicated for easy comprehension.</p>
<p>The reference in the text will sometimes become a link, sometimes
not.  Sometimes the reference text will remain, sometimes not.  We
don’t know <em>at the reference</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>This is a `hyperlink reference`_; its text will remain.
This is an `inline icon`_; its text will disappear.
</pre></div>
</div>
<p>That’s a problem.</p>
</li>
</ol>
<p>The syntax that has been incorporated into the spec and parser is
reference alternative 4d with definition alternative 3:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="o">|</span><span class="n">biohazard</span><span class="o">|</span> <span class="n">symbol</span><span class="o">...</span>

<span class="o">..</span> <span class="o">|</span><span class="n">biohazard</span><span class="o">|</span> <span class="n">image</span><span class="p">::</span> <span class="n">biohazard</span><span class="o">.</span><span class="n">png</span>
   <span class="p">[</span><span class="n">height</span><span class="o">=</span><span class="mi">20</span> <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
<p>We can also combine substitution references with hyperlink references,
by appending a “_” (named hyperlink reference) or “__” (anonymous
hyperlink reference) suffix to the substitution reference.  This
allows us to click on an image-link:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="o">|</span><span class="n">biohazard</span><span class="o">|</span><span class="n">_</span> <span class="n">symbol</span><span class="o">...</span>

<span class="o">..</span> <span class="o">|</span><span class="n">biohazard</span><span class="o">|</span> <span class="n">image</span><span class="p">::</span> <span class="n">biohazard</span><span class="o">.</span><span class="n">png</span>
   <span class="p">[</span><span class="n">height</span><span class="o">=</span><span class="mi">20</span> <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">]</span>
<span class="o">..</span> <span class="n">_biohazard</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">cdc</span><span class="o">.</span><span class="n">gov</span><span class="o">/</span>
</pre></div>
</div>
<p>There have been several suggestions for the naming of these
constructs, originally called “substitution references” and
“substitutions”.</p>
<ol class="arabic simple">
<li><p>Candidate names for the reference construct:</p>
<ol class="loweralpha simple">
<li><p>substitution reference</p></li>
<li><p>tagging reference</p></li>
<li><p>inline directive reference</p></li>
<li><p>directive reference</p></li>
<li><p>indirect inline directive reference</p></li>
<li><p>inline directive placeholder</p></li>
<li><p>inline directive insertion reference</p></li>
<li><p>directive insertion reference</p></li>
<li><p>insertion reference</p></li>
<li><p>directive macro reference</p></li>
<li><p>macro reference</p></li>
<li><p>substitution directive reference</p></li>
</ol>
</li>
<li><p>Candidate names for the definition construct:</p>
<ol class="loweralpha simple">
<li><p>substitution</p></li>
<li><p>substitution directive</p></li>
<li><p>tag</p></li>
<li><p>tagged directive</p></li>
<li><p>directive target</p></li>
<li><p>inline directive</p></li>
<li><p>inline directive definition</p></li>
<li><p>referenced directive</p></li>
<li><p>indirect directive</p></li>
<li><p>indirect directive definition</p></li>
<li><p>directive definition</p></li>
<li><p>indirect inline directive</p></li>
<li><p>named directive definition</p></li>
<li><p>inline directive insertion definition</p></li>
<li><p>directive insertion definition</p></li>
<li><p>insertion definition</p></li>
<li><p>insertion directive</p></li>
<li><p>substitution definition</p></li>
<li><p>directive macro definition</p></li>
<li><p>macro definition</p></li>
<li><p>substitution directive definition</p></li>
<li><p>substitution definition</p></li>
</ol>
</li>
</ol>
<p>“Inline directive reference” (1c) seems to be an appropriate term at
first, but the term “inline” is redundant in the case of the
reference.  Its counterpart “inline directive definition” (2g) is
awkward, because the directive definition itself is not inline.</p>
<p>“Directive reference” (1d) and “directive definition” (2k) are too
vague.  “Directive definition” could be used to refer to any
directive, not just those used for inline substitutions.</p>
<p>One meaning of the term “macro” (1k, 2s, 2t) is too
programming-language-specific.  Also, macros are typically simple text
substitution mechanisms: the text is substituted first and evaluated
later.  reStructuredText substitution definitions are evaluated in
place at parse time and substituted afterwards.</p>
<p>“Insertion” (1h, 1i, 2n-2q) is almost right, but it implies that
something new is getting added rather than one construct being
replaced by another.</p>
<p>Which brings us back to “substitution”.  The overall best names are
“substitution reference” (1a) and “substitution definition” (2v).  A
long way to go to add one word!</p>
</div>
<div class="section" id="inline-external-targets">
<h3><a class="toc-backref" href="#id34">Inline External Targets</a><a class="headerlink" href="#inline-external-targets" title="永久链接至标题">¶</a></h3>
<p>Currently reStructuredText has two hyperlink syntax variations:</p>
<ul>
<li><p>Named hyperlinks:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>This is a named reference_ of one word (&quot;reference&quot;).  Here is
a `phrase reference`_.  Phrase references may even cross `line
boundaries`_.

.. _reference: http://www.example.org/reference/
.. _phrase reference: http://www.example.org/phrase_reference/
.. _line boundaries: http://www.example.org/line_boundaries/
</pre></div>
</div>
<ul class="simple">
<li><p>Advantages:</p>
<ul>
<li><p>The plaintext is readable.</p></li>
<li><p>Each target may be reused multiple times (e.g., just write
<code class="docutils literal notranslate"><span class="pre">&quot;reference_&quot;</span></code> again).</p></li>
<li><p>No syncronized ordering of references and targets is necessary.</p></li>
</ul>
</li>
<li><p>Disadvantages:</p>
<ul>
<li><p>The reference text must be repeated as target names; could lead
to mistakes.</p></li>
<li><p>The target URLs may be located far from the references, and hard
to find in the plaintext.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Anonymous hyperlinks (in current reStructuredText):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>This is an anonymous reference__.  Here is an anonymous
`phrase reference`__.  Phrase references may even cross `line
boundaries`__.

__ http://www.example.org/reference/
__ http://www.example.org/phrase_reference/
__ http://www.example.org/line_boundaries/
</pre></div>
</div>
<ul class="simple">
<li><p>Advantages:</p>
<ul>
<li><p>The plaintext is readable.</p></li>
<li><p>The reference text does not have to be repeated.</p></li>
</ul>
</li>
<li><p>Disadvantages:</p>
<ul>
<li><p>References and targets must be kept in sync.</p></li>
<li><p>Targets cannot be reused.</p></li>
<li><p>The target URLs may be located far from the references.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>For comparison and historical background, StructuredText also has two
syntaxes for hyperlinks:</p>
<ul>
<li><p>First, <code class="docutils literal notranslate"><span class="pre">&quot;reference</span> <span class="pre">text&quot;:URL</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="s2">&quot;reference&quot;</span><span class="p">:</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span>
<span class="n">of</span> <span class="n">one</span> <span class="n">word</span> <span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">)</span><span class="o">.</span>  <span class="n">Here</span> <span class="ow">is</span> <span class="n">a</span> <span class="s2">&quot;phrase</span>
<span class="n">reference</span><span class="s2">&quot;:http://www.example.org/phrase_reference/.</span>
</pre></div>
</div>
</li>
<li><p>Second, <code class="docutils literal notranslate"><span class="pre">&quot;reference</span> <span class="pre">text&quot;,</span> <span class="pre">http://example.com/absolute_URL</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span>
<span class="n">of</span> <span class="n">one</span> <span class="n">word</span> <span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">)</span><span class="o">.</span>  <span class="n">Here</span> <span class="ow">is</span> <span class="n">a</span> <span class="s2">&quot;phrase reference&quot;</span><span class="p">,</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">phrase_reference</span><span class="o">/.</span>
</pre></div>
</div>
</li>
</ul>
<p>Both syntaxes share advantages and disadvantages:</p>
<ul class="simple">
<li><p>Advantages:</p>
<ul>
<li><p>The target is specified immediately adjacent to the reference.</p></li>
</ul>
</li>
<li><p>Disadvantages:</p>
<ul>
<li><p>Poor plaintext readability.</p></li>
<li><p>Targets cannot be reused.</p></li>
<li><p>Both syntaxes use double quotes, common in ordinary text.</p></li>
<li><p>In the first syntax, the URL and the last word are stuck
together, exacerbating the line wrap problem.</p></li>
<li><p>The second syntax is too magical; text could easily be written
that way by accident (although only absolute URLs are recognized
here, perhaps because of the potential for ambiguity).</p></li>
</ul>
</li>
</ul>
<p>A new type of “inline external hyperlink” has been proposed.</p>
<ol class="arabic">
<li><p>On 2002-06-28, Simon Budig <a class="reference external" href="http://mail.python.org/pipermail/doc-sig/2002-June/002648.html">proposed</a> a new syntax for
reStructuredText hyperlinks:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>This is a reference_(http://www.example.org/reference/) of one
word (&quot;reference&quot;).  Here is a `phrase
reference`_(http://www.example.org/phrase_reference/).  Are
these examples, (single-underscore), named?  If so, `anonymous
references`__(http://www.example.org/anonymous/) using two
underscores would probably be preferable.
</pre></div>
</div>
<p>The syntax, advantages, and disadvantages are similar to those of
StructuredText.</p>
<ul class="simple">
<li><p>Advantages:</p>
<ul>
<li><p>The target is specified immediately adjacent to the reference.</p></li>
</ul>
</li>
<li><p>Disadvantages:</p>
<ul>
<li><p>Poor plaintext readability.</p></li>
<li><p>Targets cannot be reused (unless named, but the semantics are
unclear).</p></li>
</ul>
</li>
<li><p>Problems:</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">&quot;`ref`_(URL)&quot;</span></code> syntax forces the last word of the
reference text to be joined to the URL, making a potentially
very long word that can’t be wrapped (URLs can be very long).
The reference and the URL should be separate.  This is a
symptom of the following point:</p></li>
<li><p>The syntax produces a single compound construct made up of two
equally important parts, <em>with syntax in the middle</em>, <em>between</em>
the reference and the target.  This is unprecedented in
reStructuredText.</p></li>
<li><p>The “inline hyperlink” text is <em>not</em> a named reference (there’s
no lookup by name), so it shouldn’t look like one.</p></li>
<li><p>According to the IETF standards RFC 2396 and RFC 2732,
parentheses are legal URI characters and curly braces are legal
email characters, making their use prohibitively difficult.</p></li>
<li><p>The named/anonymous semantics are unclear.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>After an <a class="reference external" href="http://mail.python.org/pipermail/doc-sig/2002-July/002670.html">analysis</a> of the syntax of (1) above, we came up with the
following compromise syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>This is an anonymous reference__
__&lt;http://www.example.org/reference/&gt; of one word
(&quot;reference&quot;).  Here is a `phrase reference`__
__&lt;http://www.example.org/phrase_reference/&gt;.  `Named
references`_ _&lt;http://www.example.org/anonymous/&gt; use single
underscores.
</pre></div>
</div>
<p>The syntax builds on that of the existing “inline internal
targets”: <code class="docutils literal notranslate"><span class="pre">an</span> <span class="pre">_`inline</span> <span class="pre">internal</span> <span class="pre">target`.</span></code></p>
<ul class="simple">
<li><p>Advantages:</p>
<ul>
<li><p>The target is specified immediately adjacent to the reference,
improving maintainability:</p>
<ul>
<li><p>References and targets are easily kept in sync.</p></li>
<li><p>The reference text does not have to be repeated.</p></li>
</ul>
</li>
<li><p>The construct is executed in two parts: references identical to
existing references, and targets that are new but not too big a
stretch from current syntax.</p></li>
<li><p>There’s overwhelming precedent for quoting URLs with angle
brackets <a class="footnote-reference brackets" href="#id5" id="id4">1</a>.</p></li>
</ul>
</li>
<li><p>Disadvantages:</p>
<ul>
<li><p>Poor plaintext readability.</p></li>
<li><p>Lots of “line noise”.</p></li>
<li><p>Targets cannot be reused (unless named; see below).</p></li>
</ul>
</li>
</ul>
<p>To alleviate the readability issue slightly, we could allow the
target to appear later, such as after the end of the sentence:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>This is a named reference__ of one word (&quot;reference&quot;).
__&lt;http://www.example.org/reference/&gt;  Here is a `phrase
reference`__.  __&lt;http://www.example.org/phrase_reference/&gt;
</pre></div>
</div>
<p>Problem: this could only work for one reference at a time
(reference/target pairs must be proximate [refA trgA refB trgB],
not interleaved [refA refB trgA trgB] or nested [refA refB trgB
trgA]).  This variation is too problematic; references and inline
external targets will have to be kept imediately adjacent (see (3)
below).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;reference__</span> <span class="pre">__&lt;target&gt;&quot;</span></code> syntax is actually for “anonymous
inline external targets”, emphasized by the double underscores.  It
follows that single trailing and leading underscores would lead to
<em>implicitly named</em> inline external targets.  This would allow the
reuse of targets by name.  So after <code class="docutils literal notranslate"><span class="pre">&quot;reference_</span> <span class="pre">_&lt;target&gt;&quot;</span></code>,
another <code class="docutils literal notranslate"><span class="pre">&quot;reference_&quot;</span></code> would point to the same target.</p>
<dl class="footnote brackets">
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id4">1</a></span></dt>
<dd><p>From RFC 2396 (URI syntax):</p>
<blockquote>
<div><p>The angle-bracket “&lt;” and “&gt;” and double-quote (“)
characters are excluded [from URIs] because they are often
used as the delimiters around URI in text documents and
protocol fields.</p>
<p>Using &lt;&gt; angle brackets around each URI is especially
recommended as a delimiting style for URI that contain
whitespace.</p>
</div></blockquote>
<p>From RFC 822 (email headers):</p>
<blockquote>
<div><p>Angle brackets (“&lt;” and “&gt;”) are generally used to indicate
the presence of a one machine-usable reference (e.g.,
delimiting mailboxes), possibly including source-routing to
the machine.</p>
</div></blockquote>
</dd>
</dl>
</li>
<li><p>If it is best for references and inline external targets to be
immediately adjacent, then they might as well be integrated.
Here’s an alternative syntax embedding the target URL in the
reference:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>This is an anonymous `reference &lt;http://www.example.org
/reference/&gt;`__ of one word (&quot;reference&quot;).  Here is a `phrase
reference &lt;http://www.example.org/phrase_reference/&gt;`__.
</pre></div>
</div>
<p>Advantages and disadvantages are similar to those in (2).
Readability is still an issue, but the syntax is a bit less
heavyweight (reduced line noise).  Backquotes are required, even
for one-word references; the target URL is included within the
reference text, forcing a phrase context.</p>
<p>We’ll call this variant “embedded URIs”.</p>
<p>Problem: how to refer to a title like “HTML Anchors: &lt;a&gt;” (which
ends with an HTML/SGML/XML tag)?  We could either require more
syntax on the target (like <code class="docutils literal notranslate"><span class="pre">&quot;`reference</span> <span class="pre">text</span>
<span class="pre">__&lt;http://example.com/&gt;`__&quot;</span></code>), or require the odd conflicting
title to be escaped (like <code class="docutils literal notranslate"><span class="pre">&quot;`HTML</span> <span class="pre">Anchors:</span> <span class="pre">\&lt;a&gt;`__&quot;</span></code>).  The
latter seems preferable, and not too onerous.</p>
<p>Similarly to (2) above, a single trailing underscore would convert
the reference &amp; inline external target from anonymous to implicitly
named, allowing reuse of targets by name.</p>
<p>I think this is the least objectionable of the syntax alternatives.</p>
</li>
</ol>
<p>Other syntax variations have been proposed (by Brett Cannon and Benja
Fallenstein):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`phrase reference`-&gt;http://www.example.com

`phrase reference`@http://www.example.com

`phrase reference`__ -&gt;http://www.example.com

`phrase reference` [-&gt; http://www.example.com]

`phrase reference`__ [-&gt; http://www.example.com]

`phrase reference` &lt;http://www.example.com&gt;_
</pre></div>
</div>
<p>None of these variations are clearly superior to #3 above.  Some have
problems that exclude their use.</p>
<p>With any kind of inline external target syntax it comes down to the
conflict between maintainability and plaintext readability.  I don’t
see a major problem with reStructuredText’s maintainability, and I
don’t want to sacrifice plaintext readability to “improve” it.</p>
<p>The proponents of inline external targets want them for easily
maintainable web pages.  The arguments go something like this:</p>
<ul>
<li><p>Named hyperlinks are difficult to maintain because the reference
text is duplicated as the target name.</p>
<p>To which I said, “So use anonymous hyperlinks.”</p>
</li>
<li><p>Anonymous hyperlinks are difficult to maintain becuase the
references and targets have to be kept in sync.</p>
<p>“So keep the targets close to the references, grouped after each
paragraph.  Maintenance is trivial.”</p>
</li>
<li><p>But targets grouped after paragraphs break the flow of text.</p>
<p>“Surely less than URLs embedded in the text!  And if the intent is
to produce web pages, not readable plaintext, then who cares about
the flow of text?”</p>
</li>
</ul>
<p>Many participants have voiced their objections to the proposed syntax:</p>
<blockquote>
<div><p>Garth Kidd: “I strongly prefer the current way of doing it.
Inline is spectactularly messy, IMHO.”</p>
<p>Tony Ibbs: “I vehemently agree… that the inline alternatives
being suggested look messy - there are/were good reasons they’ve
been taken out…  I don’t believe I would gain from the new
syntaxes.”</p>
<p>Paul Moore: “I agree as well.  The proposed syntax is far too
punctuation-heavy, and any of the alternatives discussed are
ambiguous or too subtle.”</p>
</div></blockquote>
<p>Others have voiced their support:</p>
<blockquote>
<div><p>fantasai: “I agree with Simon.  In many cases, though certainly
not in all, I find parenthesizing the url in plain text flows
better than relegating it to a footnote.”</p>
<p>Ken Manheimer: “I’d like to weigh in requesting some kind of easy,
direct inline reference link.”</p>
</div></blockquote>
<p>(Interesting that those <em>against</em> the proposal have been using
reStructuredText for a while, and those <em>for</em> the proposal are either
new to the list [“fantasai”, background unknown] or longtime
StructuredText users [Ken Manheimer].)</p>
<p>I was initially ambivalent/against the proposed “inline external
targets”.  I value reStructuredText’s readability very highly, and
although the proposed syntax offers convenience, I don’t know if the
convenience is worth the cost in ugliness.  Does the proposed syntax
compromise readability too much, or should the choice be left up to
the author?  Perhaps if the syntax is <em>allowed</em> but its use strongly
<em>discouraged</em>, for aesthetic/readability reasons?</p>
<p>After a great deal of thought and much input from users, I’ve decided
that there are reasonable use cases for this construct.  The
documentation should strongly caution against its use in most
situations, recommending independent block-level targets instead.
Syntax #3 above (“embedded URIs”) will be used.</p>
</div>
<div class="section" id="doctree-representation-of-transitions">
<h3><a class="toc-backref" href="#id35">Doctree Representation of Transitions</a><a class="headerlink" href="#doctree-representation-of-transitions" title="永久链接至标题">¶</a></h3>
<p>(Although not reStructuredText-specific, this section fits best in
this document.)</p>
<p>Having added the “horizontal rule” construct to the <a class="reference external" href="../../ref/rst/restructuredtext.html">reStructuredText
Markup Specification</a>, a decision had to be made as to how to reflect
the construct in the implementation of the document tree.  Given this
source:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Document</span>
<span class="o">========</span>

<span class="n">Paragraph</span> <span class="mi">1</span>

<span class="o">--------</span>

<span class="n">Paragraph</span> <span class="mi">2</span>
</pre></div>
</div>
<p>The horizontal rule indicates a “transition” (in prose terms) or the
start of a new “division”.  Before implementation, the parsed document
tree would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">document</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">section</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span>
            <span class="n">Document</span>
        <span class="o">&lt;</span><span class="n">paragraph</span><span class="o">&gt;</span>
            <span class="n">Paragraph</span> <span class="mi">1</span>
        <span class="o">--------</span>               <span class="o">&lt;---</span> <span class="n">error</span> <span class="n">here</span>
        <span class="o">&lt;</span><span class="n">paragraph</span><span class="o">&gt;</span>
            <span class="n">Paragraph</span> <span class="mi">2</span>
</pre></div>
</div>
<p>There are several possibilities for the implementation:</p>
<ol class="arabic">
<li><p>Implement horizontal rules as “divisions” or segments.  A
“division” is a title-less, non-hierarchical section.  The first
try at an implementation looked like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">document</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">section</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span>
            <span class="n">Document</span>
        <span class="o">&lt;</span><span class="n">paragraph</span><span class="o">&gt;</span>
            <span class="n">Paragraph</span> <span class="mi">1</span>
        <span class="o">&lt;</span><span class="n">division</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">paragraph</span><span class="o">&gt;</span>
                <span class="n">Paragraph</span> <span class="mi">2</span>
</pre></div>
</div>
<p>But the two paragraphs are really at the same level; they shouldn’t
appear to be at different levels.  There’s really an invisible
“first division”.  The horizontal rule splits the document body
into two segments, which should be treated uniformly.</p>
</li>
<li><p>Treating “divisions” uniformly brings us to the second
possibility:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">document</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">section</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span>
            <span class="n">Document</span>
        <span class="o">&lt;</span><span class="n">division</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">paragraph</span><span class="o">&gt;</span>
                <span class="n">Paragraph</span> <span class="mi">1</span>
        <span class="o">&lt;</span><span class="n">division</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">paragraph</span><span class="o">&gt;</span>
                <span class="n">Paragraph</span> <span class="mi">2</span>
</pre></div>
</div>
<p>With this change, documents and sections will directly contain
divisions and sections, but not body elements.  Only divisions will
directly contain body elements.  Even without a horizontal rule
anywhere, the body elements of a document or section would be
contained within a division element.  This makes the document tree
deeper.  This is similar to the way <a class="reference external" href="http://www.w3.org/MarkUp/">HTML</a> treats document contents:
grouped within a <code class="docutils literal notranslate"><span class="pre">&lt;body&gt;</span></code> element.</p>
</li>
<li><p>Implement them as “transitions”, empty elements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">document</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">section</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span>
            <span class="n">Document</span>
        <span class="o">&lt;</span><span class="n">paragraph</span><span class="o">&gt;</span>
            <span class="n">Paragraph</span> <span class="mi">1</span>
        <span class="o">&lt;</span><span class="n">transition</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">paragraph</span><span class="o">&gt;</span>
            <span class="n">Paragraph</span> <span class="mi">2</span>
</pre></div>
</div>
<p>A transition would be a “point element”, not containing anything,
only identifying a point within the document structure.  This keeps
the document tree flatter, but the idea of a “point element” like
“transition” smells bad.  A transition isn’t a thing itself, it’s
the space between two divisions.  However, transitions are a
practical solution.</p>
</li>
</ol>
<p>Solution 3 was chosen for incorporation into the document tree model.</p>
</div>
<div class="section" id="syntax-for-line-blocks">
<h3><a class="toc-backref" href="#id36">Syntax for Line Blocks</a><a class="headerlink" href="#syntax-for-line-blocks" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>An early idea: How about a literal-block-like prefix, perhaps
“<code class="docutils literal notranslate"><span class="pre">;;</span></code>”?  (It is, after all, a <em>semi-literal</em> literal block, no?)
Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Take it away, Eric the Orchestra Leader!  ;;

    A one, two, a one two three four

    Half a bee, philosophically,
    must, *ipso facto*, half not be.
    But half the bee has got to be,
    *vis a vis* its entity.  D&#39;you see?

    But can a bee be said to be
    or not to be an entire bee,
    when half the bee is not a bee,
    due to some ancient injury?

    Singing...
</pre></div>
</div>
<p>Kinda lame.</p>
</li>
<li><p>Another idea: in an ordinary paragraph, if the first line ends with
a backslash (escaping the newline), interpret the entire paragraph
as a verse block?  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Add</span> <span class="n">just</span> <span class="n">one</span> <span class="n">backslash</span>\
<span class="n">And</span> <span class="n">this</span> <span class="n">paragraph</span> <span class="n">becomes</span>
<span class="n">An</span> <span class="n">awful</span> <span class="n">haiku</span>
</pre></div>
</div>
<p>(Awful, and arguably invalid, since in Japanese the word “haiku”
contains three syllables not two.)</p>
<p>This idea was superceded by the rules for escaped whitespace, useful
for <a class="reference external" href="../../ref/rst/restructuredtext.html#character-level-inline-markup">character-level inline markup</a>.</p>
</li>
<li><p>In a <a class="reference external" href="http://thread.gmane.org/gmane.text.docutils.devel/1187">2004-02-22 docutils-develop message</a>, Jarno Elonen proposed
a “plain list” syntax (and also provided a patch):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span> <span class="n">John</span> <span class="n">Doe</span>
<span class="o">|</span> <span class="n">President</span><span class="p">,</span> <span class="n">SuperDuper</span> <span class="n">Corp</span><span class="o">.</span>
<span class="o">|</span> <span class="n">jdoe</span><span class="nd">@example</span><span class="o">.</span><span class="n">org</span>
</pre></div>
</div>
<p>This syntax is very natural.  However, these “plain lists” seem very
similar to line blocks, and I see so little intrinsic “list-ness”
that I’m loathe to add a new object.  I used the term “blurbs” to
remove the “list” connotation from the originally proposed name.
Perhaps line blocks could be refined to add the two properties they
currently lack:</p>
<ol class="upperalpha simple">
<li><p>long lines wrap nicely</p></li>
<li><p>HTML output doesn’t look like program code in non-CSS web
browsers</p></li>
</ol>
<p>(A) is an issue of all 3 aspects of Docutils: syntax (construct
behaviour), internal representation, and output.  (B) is partly an
issue of internal representation but mostly of output.</p>
</li>
</ul>
<p>ReStructuredText will redefine line blocks with the “|”-quoting
syntax.  The following is my current thinking.</p>
<div class="section" id="syntax">
<h4><a class="toc-backref" href="#id37">Syntax</a><a class="headerlink" href="#syntax" title="永久链接至标题">¶</a></h4>
<p>Perhaps line block syntax like this would do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span> <span class="n">M6</span><span class="p">:</span> <span class="n">James</span> <span class="n">Bond</span>
<span class="o">|</span> <span class="n">MIB</span><span class="p">:</span> <span class="n">Mr</span><span class="o">.</span> <span class="n">J</span><span class="o">.</span>
<span class="o">|</span> <span class="n">IMF</span><span class="p">:</span> <span class="ow">not</span> <span class="n">decided</span> <span class="n">yet</span><span class="p">,</span> <span class="n">but</span> <span class="n">probably</span> <span class="n">one</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span><span class="p">:</span>
<span class="o">|</span>   <span class="n">Ethan</span> <span class="n">Hunt</span>
<span class="o">|</span>   <span class="n">Jim</span> <span class="n">Phelps</span>
<span class="o">|</span>   <span class="n">Claire</span> <span class="n">Phelps</span>
<span class="o">|</span> <span class="n">CIA</span><span class="p">:</span> <span class="n">Lea</span> <span class="n">Leiter</span>
</pre></div>
</div>
<p>Note that the “nested” list does not have nested syntax (the “|” are
not further indented); the leading whitespace would still be
significant somehow (more below).  As for long lines in the input,
this could suffice:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span> <span class="n">John</span> <span class="n">Doe</span>
<span class="o">|</span> <span class="n">Founder</span><span class="p">,</span> <span class="n">President</span><span class="p">,</span> <span class="n">Chief</span> <span class="n">Executive</span> <span class="n">Officer</span><span class="p">,</span> <span class="n">Cook</span><span class="p">,</span> <span class="n">Bottle</span>
  <span class="n">Washer</span><span class="p">,</span> <span class="ow">and</span> <span class="n">All</span><span class="o">-</span><span class="n">Round</span> <span class="n">Great</span> <span class="n">Guy</span>
<span class="o">|</span> <span class="n">SuperDuper</span> <span class="n">Corp</span><span class="o">.</span>
<span class="o">|</span> <span class="n">jdoe</span><span class="nd">@example</span><span class="o">.</span><span class="n">org</span>
</pre></div>
</div>
<p>The lack of “|” on the third line indicates that it’s a continuation
of the second line, wrapped.</p>
<p>I don’t see much point in allowing arbitrary nested content.  Multiple
paragraphs or bullet lists inside a “blurb” doesn’t make sense to me.
Simple nested line blocks should suffice.</p>
</div>
<div class="section" id="internal-representation">
<h4><a class="toc-backref" href="#id38">Internal Representation</a><a class="headerlink" href="#internal-representation" title="永久链接至标题">¶</a></h4>
<p>Line blocks are currently represented as text blobs as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!ELEMENT line_block %text.model;&gt;
&lt;!ATTLIST line_block
    %basic.atts;
    %fixedspace.att;&gt;
</pre></div>
</div>
<p>Instead, we could represent each line by a separate element:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!ELEMENT line_block (line+)&gt;
&lt;!ATTLIST line_block %basic.atts;&gt;

&lt;!ELEMENT line %text.model;&gt;
&lt;!ATTLIST line %basic.atts;&gt;
</pre></div>
</div>
<p>We’d keep the significance of the leading whitespace of each line
either by converting it to non-breaking spaces at output, or with a
per-line margin.  Non-breaking spaces are simpler (for HTML, anyway)
but kludgey, and wouldn’t support indented long lines that wrap.  But
should inter-word whitespace (i.e., not leading whitespace) be
preserved?  Currently it is preserved in line blocks.</p>
<p>Representing a more complex line block may be tricky:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| But can a bee be said to be
|     or not to be an entire bee,
|         when half the bee is not a bee,
|             due to some ancient injury?
</pre></div>
</div>
<p>Perhaps the representation could allow for nested line blocks:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!ELEMENT line_block (line | line_block)+&gt;
</pre></div>
</div>
<p>With this model, leading whitespace would no longer be significant.
Instead, left margins are implied by the nesting.  The example above
could be represented as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;line_block&gt;
    &lt;line&gt;
        But can a bee be said to be
    &lt;line_block&gt;
        &lt;line&gt;
             or not to be an entire bee,
        &lt;line_block&gt;
            &lt;line&gt;
                when half the bee is not a bee,
            &lt;line_block&gt;
                &lt;line&gt;
                    due to some ancient injury?
</pre></div>
</div>
<p>I wasn’t sure what to do about even more complex line blocks:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span>     <span class="n">Indented</span>
<span class="o">|</span> <span class="n">Not</span> <span class="n">indented</span>
<span class="o">|</span>   <span class="n">Indented</span> <span class="n">a</span> <span class="n">bit</span>
<span class="o">|</span>     <span class="n">A</span> <span class="n">bit</span> <span class="n">more</span>
<span class="o">|</span>  <span class="n">Only</span> <span class="n">one</span> <span class="n">space</span>
</pre></div>
</div>
<p>How should that be parsed and nested?  Should the first line have
the same nesting level (== indentation in the output) as the fourth
line, or the same as the last line?  Mark Nodine suggested that such
line blocks be parsed similarly to complexly-nested block quotes,
which seems reasonable.  In the example above, this would result in
the nesting of first line matching the last line’s nesting.  In
other words, the nesting would be relative to neighboring lines
only.</p>
</div>
<div class="section" id="output">
<h4><a class="toc-backref" href="#id39">Output</a><a class="headerlink" href="#output" title="永久链接至标题">¶</a></h4>
<p>In HTML, line blocks are currently output as “&lt;pre&gt;” blocks, which
gives us significant whitespace and line breaks, but doesn’t allow
long lines to wrap and causes monospaced output without stylesheets.
Instead, we could output “&lt;div&gt;” elements parallelling the
representation above, where each nested &lt;div class=”line_block”&gt; would
have an increased left margin (specified in the stylesheet).</p>
<p>Jarno suggested the following HTML output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;line_block&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="o">&gt;</span><span class="n">First</span><span class="p">,</span> <span class="n">top</span> <span class="n">level</span> <span class="n">line</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;</span><span class="n">br</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="o">/&gt;</span>
   <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;line_block&quot;</span><span class="o">&gt;&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="o">&gt;&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="o">&gt;</span><span class="n">Second</span><span class="p">,</span> <span class="n">once</span> <span class="n">nested</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;</span><span class="n">br</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="o">&gt;</span><span class="n">Third</span><span class="p">,</span> <span class="n">once</span> <span class="n">nested</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;</span><span class="n">br</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="o">/&gt;</span>
      <span class="o">...</span>
   <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
   <span class="o">...</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;br</span> <span class="pre">class=&quot;hidden&quot;</span> <span class="pre">/&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;span</span>
<span class="pre">class=&quot;hidden&quot;&gt;&amp;nbsp;&lt;/span&gt;</span></code> are meant to support non-CSS and
non-graphical browsers.  I understand the case for “br”, but I’m not
so sure about hidden “&amp;nbsp;”.  I question how much effort should be
put toward supporting non-graphical and especially non-CSS browsers,
at least for html4css1.py output.</p>
<p>Should the lines themselves be <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>?  I don’t like
mixing inline and block-level elements.</p>
</div>
<div class="section" id="implementation-plan">
<h4><a class="toc-backref" href="#id40">Implementation Plan</a><a class="headerlink" href="#implementation-plan" title="永久链接至标题">¶</a></h4>
<p>We’ll leave the old implementation in place (via the “line-block”
directive only) until all Writers have been updated to support the new
syntax &amp; implementation.  The “line-block” directive can then be
updated to use the new internal representation, and its documentation
will be updated to recommend the new syntax.</p>
</div>
</div>
<div class="section" id="list-driven-tables">
<h3><a class="toc-backref" href="#id41">List-Driven Tables</a><a class="headerlink" href="#list-driven-tables" title="永久链接至标题">¶</a></h3>
<p>The original idea came from Dylan Jay:</p>
<blockquote>
<div><p>… to use a two level bulleted list with something to
indicate it should be rendered as a table …</p>
</div></blockquote>
<p>It’s an interesting idea.  It could be implemented in as a directive
which transforms a uniform two-level list into a table.  Using a
directive would allow the author to explicitly set the table’s
orientation (by column or by row), the presence of row headers, etc.</p>
<p>Alternatives:</p>
<ol class="arabic">
<li><p>(Implemented in Docutils 0.3.8).</p>
<p>Bullet-list-tables might look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. list-table::

   * - Treat
     - Quantity
     - Description
   * - Albatross!
     - 299
     - On a stick!
   * - Crunchy Frog!
     - 1499
     - If we took the bones out, it wouldn&#39;t be crunchy,
       now would it?
   * - Gannet Ripple!
     - 199
     - On a stick!
</pre></div>
</div>
<p>This list must be written in two levels.  This wouldn’t work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. list-table::

   * Treat
   * Albatross!
   * Gannet!
   * Crunchy Frog!

   * Quantity
   * 299
   * 199
   * 1499

   * Description
   * On a stick!
   * On a stick!
   * If we took the bones out...
</pre></div>
</div>
<p>The above is a single list of 12 items.  The blank lines are not
significant to the markup.  We’d have to explicitly specify how
many columns or rows to use, which isn’t a good idea.</p>
</li>
<li><p>Beni Cherniavsky suggested a field list alternative.  It could look
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. field-list-table::
   :headrows: 1

   - :treat: Treat
     :quantity: Quantity
     :descr: Description

   - :treat: Albatross!
     :quantity: 299
     :descr: On a stick!

   - :treat: Crunchy Frog!
     :quantity: 1499
     :descr: If we took the bones out, it wouldn&#39;t be
             crunchy, now would it?
</pre></div>
</div>
<p>Column order is determined from the order of fields in the first
row.  Field order in all other rows is ignored.  As a side-effect,
this allows trivial re-arrangement of columns.  By using named
fields, it becomes possible to omit fields in some rows without
losing track of things, which is important for spans.</p>
</li>
<li><p>An alternative to two-level bullet lists would be to use enumerated
lists for the table cells:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. list-table::

    * 1. Treat
      2. Quantity
      3. Description
    * 1. Albatross!
      2. 299
      3. On a stick!
    * 1. Crunchy Frog!
      2. 1499
      3. If we took the bones out, it wouldn&#39;t be crunchy,
         now would it?
</pre></div>
</div>
<p>That provides better correspondence between cells in the same
column than does bullet-list syntax, but not as good as field list
syntax.  I think that were only field-list-tables available, a lot
of users would use the equivalent degenerate case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">field</span><span class="o">-</span><span class="nb">list</span><span class="o">-</span><span class="n">table</span><span class="p">::</span>
    <span class="o">-</span> <span class="p">:</span><span class="mi">1</span><span class="p">:</span> <span class="n">Treat</span>
      <span class="p">:</span><span class="mi">2</span><span class="p">:</span> <span class="n">Quantity</span>
      <span class="p">:</span><span class="mi">3</span><span class="p">:</span> <span class="n">Description</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
<li><p>Another natural variant is to allow a description list with field
lists as descriptions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. list-table::
    :headrows: 1

    Treat
        :quantity: Quantity
        :descr: Description
    Albatross!
        :quantity: 299
        :descr: On a stick!
    Crunchy Frog!
        :quantity: 1499
        :descr: If we took the bones out, it wouldn&#39;t be
                crunchy, now would it?
</pre></div>
</div>
<p>This would make the whole first column a header column (“stub”).
It’s limited to a single column and a single paragraph fitting on
one source line.  Also it wouldn’t allow for empty cells or row
spans in the first column.  But these are limitations that we could
live with, like those of simple tables.</p>
</li>
</ol>
<p>The List-driven table feature could be done in many ways.  Each user
will have their preferred usage.  Perhaps a single “list-table”
directive could handle them all, depending on which options and
content are present.</p>
<p>Issues:</p>
<ul>
<li><p>How to indicate that there’s 1 header row?  Perhaps two lists?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. list-table::

   + - Treat
     - Quantity
     - Description

   * - Albatross!
     - 299
     - On a stick!
</pre></div>
</div>
<p>This is probably too subtle though.  Better would be a directive
option, like <code class="docutils literal notranslate"><span class="pre">:headrows:</span> <span class="pre">1</span></code>.  An early suggestion for the header
row(s) was to use a directive option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. field-list-table::
   :header:
       - :treat: Treat
         :quantity: Quantity
         :descr: Description
   - :treat: Albatross!
     :quantity: 299
     :descr: On a stick!
</pre></div>
</div>
<p>But the table data is at two levels and looks inconsistent.</p>
<p>In general, we cannot extract the header row from field lists’ field
names because field names cannot contain everything one might put in
a table cell.  A separate header row also allows shorter field names
and doesn’t force one to rewrite the whole table when the header
text changes.  But for simpler cases, we can offer a “:header:
fields” option, which does extract header cells from field names:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. field-list-table::
    :header: fields

    - :Treat: Albatross!
      :Quantity: 299
      :Description: On a stick!
</pre></div>
</div>
</li>
<li><p>How to indicate the column widths?  A directive option?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="nb">list</span><span class="o">-</span><span class="n">table</span><span class="p">::</span>
   <span class="p">:</span><span class="n">widths</span><span class="p">:</span> <span class="mi">15</span> <span class="mi">10</span> <span class="mi">35</span>
</pre></div>
</div>
<p>Automatic defaults from the text used?</p>
</li>
<li><p>How to handle row and/or column spans?</p>
<p>In a field list, column-spans can be indicated by specifying the
first and last fields, separated by space-dash-space or ellipsis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="p">:</span><span class="n">foo</span> <span class="o">-</span> <span class="n">baz</span><span class="p">:</span> <span class="n">quuux</span>
<span class="o">-</span> <span class="p">:</span><span class="n">foo</span> <span class="o">...</span> <span class="n">baz</span><span class="p">:</span> <span class="n">quuux</span>
</pre></div>
</div>
<p>Commas were proposed for column spans:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="p">:</span><span class="n">foo</span><span class="p">,</span> <span class="n">bar</span><span class="p">:</span> <span class="n">quux</span>
</pre></div>
</div>
<p>But non-adjacent columns become problematic.  Should we report an
error, or duplicate the value into each span of adjacent columns (as
was suggested)?  The latter suggestion is appealing but may be too
clever.  Best perhaps to simply specify the two ends.</p>
<p>It was suggested that comma syntax should be allowed, too, in order
to allow the user to avoid trouble when changing the column order.
But changing the column order of a table with spans is not trivial;
we shouldn’t make it easier to mess up.</p>
<p>One possible syntax for row-spans is to simply treat any row where a
field is missing as a row-span from the last row where it appeared.
Leaving a field empty would still be possible by writing a field
with empty content.  But this is too implicit.</p>
<p>Another way would be to require an explicit continuation marker
(<code class="docutils literal notranslate"><span class="pre">...</span></code>/<code class="docutils literal notranslate"><span class="pre">-&quot;-</span></code>/<code class="docutils literal notranslate"><span class="pre">&quot;</span></code>?) in all but the first row of a spanned
field.  Empty comments could work (“..”).  If implemented, the same
marker could also be supported in simple tables, which lack
row-spanning abilities.</p>
<p>Explicit markup like “:rowspan:” and “:colspan:” was also suggested.</p>
<p>Sometimes in a table, the first header row contains spans.  It may
be necessary to provide a way to specify the column field names
independently of data rows.  A directive option would do it.</p>
</li>
<li><p>We could specify “column-wise” or “row-wise” ordering, with the same
markup structure.  For example, with definition data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. list-table::
   :column-wise:

   Treat
       - Albatross!
       - Crunchy Frog!
   Quantity
       - 299
       - 1499
   Description
       - On a stick!
       - If we took the bones out, it wouldn&#39;t be
         crunchy, now would it?
</pre></div>
</div>
</li>
<li><p>A syntax for <span class="target" id="stubs-in-grid-tables">stubs in grid tables</span> is easy to imagine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------------------++------------+----------+</span>
<span class="o">|</span> <span class="n">Header</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span> <span class="mi">1</span>   <span class="o">||</span> <span class="n">Header</span> <span class="mi">2</span>   <span class="o">|</span> <span class="n">Header</span> <span class="mi">3</span> <span class="o">|</span>
<span class="o">+========================++============+==========+</span>
<span class="o">|</span> <span class="n">body</span> <span class="n">row</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span> <span class="mi">1</span>   <span class="o">||</span> <span class="n">column</span> <span class="mi">2</span>   <span class="o">|</span> <span class="n">column</span> <span class="mi">3</span> <span class="o">|</span>
<span class="o">+------------------------++------------+----------+</span>
</pre></div>
</div>
<p>Or this idea from Nick Moffitt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----+---+---+</span>
<span class="o">|</span> <span class="n">XOR</span> <span class="c1"># T | F |</span>
<span class="o">+=====+===+===+</span>
<span class="o">|</span>   <span class="n">T</span> <span class="c1"># F | T |</span>
<span class="o">+-----+---+---+</span>
<span class="o">|</span>   <span class="n">F</span> <span class="c1"># T | F |</span>
<span class="o">+-----+---+---+</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="auto-enumerated-lists">
<h3><a class="toc-backref" href="#id42">Auto-Enumerated Lists</a><a class="headerlink" href="#auto-enumerated-lists" title="永久链接至标题">¶</a></h3>
<p>Implemented 2005-03-24: combination of variation 1 &amp; 2.</p>
<p>The advantage of auto-numbered enumerated lists would be similar to
that of auto-numbered footnotes: lists could be written and rearranged
without having to manually renumber them.  The disadvantages are also
the same: input and output wouldn’t match exactly; the markup may be
ugly or confusing (depending on which alternative is chosen).</p>
<ol class="arabic">
<li><p>Use the “#” symbol.  Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#. Item 1.</span>
<span class="c1">#. Item 2.</span>
<span class="c1">#. Item 3.</span>
</pre></div>
</div>
<p>Advantages: simple, explicit.  Disadvantage: enumeration sequence
cannot be specified (limited to arabic numerals); ugly.</p>
</li>
<li><p>As a variation on #1, first initialize the enumeration sequence?
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">)</span> <span class="n">Item</span> <span class="n">a</span><span class="o">.</span>
<span class="c1">#) Item b.</span>
<span class="c1">#) Item c.</span>
</pre></div>
</div>
<p>Advantages: simple, explicit, any enumeration sequence possible.
Disadvantages: ugly; perhaps confusing with mixed concrete/abstract
enumerators.</p>
</li>
<li><p>Alternative suggested by Fred Bremmer, from experience with MoinMoin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">Item</span> <span class="mf">1.</span>
<span class="mf">1.</span> <span class="n">Item</span> <span class="mf">2.</span>
<span class="mf">1.</span> <span class="n">Item</span> <span class="mf">3.</span>
</pre></div>
</div>
<p>Advantages: enumeration sequence is explicit (could be multiple
“a.” or “(I)” tokens).  Disadvantages: perhaps confusing; otherwise
erroneous input (e.g., a duplicate item “1.”) would pass silently,
either causing a problem later in the list (if no blank lines
between items) or creating two lists (with blanks).</p>
<p>Take this input for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">Item</span> <span class="mf">1.</span>

<span class="mf">1.</span> <span class="n">Unintentional</span> <span class="n">duplicate</span> <span class="n">of</span> <span class="n">item</span> <span class="mf">1.</span>

<span class="mf">2.</span> <span class="n">Item</span> <span class="mf">2.</span>
</pre></div>
</div>
<p>Currently the parser will produce two list, “1” and “1,2” (no
warnings, because of the presence of blank lines).  Using Fred’s
notation, the current behavior is “1,1,2 -&gt; 1 1,2” (without blank
lines between items, it would be “1,1,2 -&gt; 1 [WARNING] 1,2”).  What
should the behavior be with auto-numbering?</p>
<p>Fred has produced a <a class="reference external" href="http://sourceforge.net/tracker/index.php?func=detail&amp;aid=548802&amp;group_id=38414&amp;atid=422032">patch</a>, whose initial behavior is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span>   <span class="o">-&gt;</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span>   <span class="o">-&gt;</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
<span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span>   <span class="o">-&gt;</span> <span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span> <span class="p">[</span><span class="n">WARNING</span><span class="p">]</span> <span class="mi">3</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span>   <span class="o">-&gt;</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="p">[</span><span class="n">WARNING</span><span class="p">]</span> <span class="mi">2</span>
</pre></div>
</div>
<p>(After the “[WARNING]”, the “3” would begin a new list.)</p>
<p>I have mixed feelings about adding this functionality to the spec &amp;
parser.  It would certainly be useful to some users (myself
included; I often have to renumber lists).  Perhaps it’s too
clever, asking the parser to guess too much.  What if you <em>do</em> want
three one-item lists in a row, each beginning with “1.”?  You’d
have to use empty comments to force breaks.  Also, I question
whether “1,2,2 -&gt; 1,2,3” is optimal behavior.</p>
<p>In response, Fred came up with “a stricter and more explicit rule
[which] would be to only auto-number silently if <em>all</em> the
enumerators of a list were identical”.  In that case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span>   <span class="o">-&gt;</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span>   <span class="o">-&gt;</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="p">[</span><span class="n">WARNING</span><span class="p">]</span> <span class="mi">2</span>
<span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span>   <span class="o">-&gt;</span> <span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="p">[</span><span class="n">WARNING</span><span class="p">]</span> <span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span>   <span class="o">-&gt;</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="p">[</span><span class="n">WARNING</span><span class="p">]</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Should any start-value be allowed (“3,3,3”), or should
auto-numbered lists be limited to begin with ordinal-1 (“1”, “A”,
“a”, “I”, or “i”)?</p>
</li>
<li><p>Alternative proposed by Tony Ibbs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#1. First item.</span>
<span class="c1">#3. Aha - I edited this in later.</span>
<span class="c1">#2. Second item.</span>
</pre></div>
</div>
<p>The initial proposal required unique enumerators within a list, but
this limits the convenience of a feature of already limited
applicability and convenience.  Not a useful requirement; dropped.</p>
<p>Instead, simply prepend a “#” to a standard list enumerator to
indicate auto-enumeration.  The numbers (or letters) of the
enumerators themselves are not significant, except:</p>
<ul class="simple">
<li><p>as a sequence indicator (arabic, roman, alphabetic; upper/lower),</p></li>
<li><p>and perhaps as a start value (first list item).</p></li>
</ul>
<p>Advantages: explicit, any enumeration sequence possible.
Disadvantages: a bit ugly.</p>
</li>
</ol>
</div>
<div class="section" id="adjacent-citation-references">
<h3><a class="toc-backref" href="#id43">Adjacent citation references</a><a class="headerlink" href="#adjacent-citation-references" title="永久链接至标题">¶</a></h3>
<p>A special case for inline markup was proposed and implemented:
multiple citation references could be joined into one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">cite1</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">cite2</span><span class="p">]</span><span class="n">_</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">requiring</span> <span class="p">[</span><span class="n">cite1</span><span class="p">]</span><span class="n">_</span> <span class="p">[</span><span class="n">cite2</span><span class="p">]</span><span class="n">_</span>
</pre></div>
</div>
<p>However, this was rejected as an unwarranted exception to the rules
for inline markup.
(The main motivation for the proposal, grouping citations in the latex writer,
was implemented by recognising the second group in the example above and
transforming it into <code class="docutils literal notranslate"><span class="pre">\cite{cite1,cite2}</span></code>.)</p>
</div>
<div class="section" id="inline-markup-recognition">
<h3><a class="toc-backref" href="#id44">Inline markup recognition</a><a class="headerlink" href="#inline-markup-recognition" title="永久链接至标题">¶</a></h3>
<p>Implemented 2011-12-05 (version 0.9):
Extended <a class="reference external" href="../../ref/rst/restructuredtext.html#inline-markup-recognition-rules">inline markup recognition rules</a>.</p>
<p>Non-ASCII whitespace, punctuation characters and “international” quotes are
allowed around inline markup (based on <a class="reference external" href="http://www.unicode.org/Public/5.1.0/ucd/UCD.html#General_Category_Values">Unicode categories</a>). The rules for
ASCII characters were not changed.</p>
<p>Rejected alternatives:</p>
<ol class="loweralpha">
<li><p>Use <a class="reference external" href="http://www.unicode.org/Public/5.1.0/ucd/UCD.html#General_Category_Values">Unicode categories</a> for all chars (ASCII or not)</p>
<dl class="option-list">
<dt><kbd><span class="option">+1</span></kbd></dt>
<dd><p>comprehensible, standards based,</p>
</dd>
<dt><kbd><span class="option">-1</span></kbd></dt>
<dd><p>many “false positives” need escaping,</p>
</dd>
<dt><kbd><span class="option">-1</span></kbd></dt>
<dd><p>not backwards compatible.</p>
</dd>
</dl>
</li>
<li><p>full backwards compatibility</p>
<dl class="field-list simple">
<dt class="field-odd">Pi</dt>
<dd class="field-odd"><p>only before start-string</p>
</dd>
<dt class="field-even">Pf</dt>
<dd class="field-even"><p>only behind end-string</p>
</dd>
<dt class="field-odd">Po</dt>
<dd class="field-odd"><p>“conservative” sorting of other punctuation:</p>
<dl class="field-list simple">
<dt class="field-odd"><code class="docutils literal notranslate"><span class="pre">.,;!?\\</span></code></dt>
<dd class="field-odd"><p>Close</p>
</dd>
<dt class="field-even"><code class="docutils literal notranslate"><span class="pre">隆驴</span></code></dt>
<dd class="field-even"><p>Open</p>
</dd>
</dl>
</dd>
</dl>
<dl class="option-list">
<dt><kbd><span class="option">+1</span></kbd></dt>
<dd><p>backwards compatible,</p>
</dd>
<dt><kbd><span class="option">+1</span></kbd></dt>
<dd><p>logical extension of the existing rules,</p>
</dd>
<dt><kbd><span class="option">-1</span></kbd></dt>
<dd><p>exception list for “other” punctuation needed,</p>
</dd>
<dt><kbd><span class="option">-1</span></kbd></dt>
<dd><p>rules even more complicated,</p>
</dd>
<dt><kbd><span class="option">-1</span></kbd></dt>
<dd><p>not clear how to sort “other” punctuation that is currently not
recognized,</p>
</dd>
<dt><kbd><span class="option">-2</span></kbd></dt>
<dd><p>international quoting convention like
禄German 鈥篴ngular鈥� quotes芦 not recognized.</p>
</dd>
</dl>
</li>
</ol>
</div>
</div>
<div class="section" id="not-implemented">
<h2><a class="toc-backref" href="#id45">Not Implemented</a><a class="headerlink" href="#not-implemented" title="永久链接至标题">¶</a></h2>
<div class="section" id="reworking-footnotes">
<h3><a class="toc-backref" href="#id46">Reworking Footnotes</a><a class="headerlink" href="#reworking-footnotes" title="永久链接至标题">¶</a></h3>
<p>As a further wrinkle (see <a class="reference internal" href="#reworking-explicit-markup-round-1">Reworking Explicit Markup (Round 1)</a>
above), in the wee hours of 2002-02-28 I posted several ideas for
changes to footnote syntax:</p>
<blockquote>
<div><ul class="simple">
<li><p>Change footnote syntax from <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">[1]</span></code> to <code class="docutils literal notranslate"><span class="pre">_[1]</span></code>? …</p></li>
<li><p>Differentiate (with new DTD elements) author-date “citations”
(<code class="docutils literal notranslate"><span class="pre">[GVR2002]</span></code>) from numbered footnotes? …</p></li>
<li><p>Render footnote references as superscripts without “[]”? …</p></li>
</ul>
</div></blockquote>
<p>These ideas are all related, and suggest changes in the
reStructuredText syntax as well as the docutils tree model.</p>
<p>The footnote has been used for both true footnotes (asides expanding
on points or defining terms) and for citations (references to external
works).  Rather than dealing with one amalgam construct, we could
separate the current footnote concept into strict footnotes and
citations.  Citations could be interpreted and treated differently
from footnotes.  Footnotes would be limited to numerical labels:
manual (“1”) and auto-numbered (anonymous “#”, named “#label”).</p>
<p>The footnote is the only explicit markup construct (starts with “.. “)
that directly translates to a visible body element.  I’ve always been
a little bit uncomfortable with the “.. ” marker for footnotes because
of this; “.. ” has a connotation of “special”, but footnotes aren’t
especially “special”.  Printed texts often put footnotes at the bottom
of the page where the reference occurs (thus “foot note”).  Some HTML
designs would leave footnotes to be rendered the same positions where
they’re defined.  Other online and printed designs will gather
footnotes into a section near the end of the document, converting them
to “endnotes” (perhaps using a directive in our case); but this
“special processing” is not an intrinsic property of the footnote
itself, but a decision made by the document author or processing
system.</p>
<p>Citations are almost invariably collected in a section at the end of a
document or section.  Citations “disappear” from where they are
defined and are magically reinserted at some well-defined point.
There’s more of a connection to the “special” connotation of the “.. ”
syntax.  The point at which the list of citations is inserted could be
defined manually by a directive (e.g., “.. citations::”), and/or have
default behavior (e.g., a section automatically inserted at the end of
the document) that might be influenced by options to the Writer.</p>
<p>Syntax proposals:</p>
<ul>
<li><p>Footnotes:</p>
<ul>
<li><p>Current syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">Footnote</span> <span class="mi">1</span>
<span class="o">..</span> <span class="p">[</span><span class="c1">#] Auto-numbered footnote.</span>
<span class="o">..</span> <span class="p">[</span><span class="c1">#label] Auto-labeled footnote.</span>
</pre></div>
</div>
</li>
<li><p>The syntax proposed in the original 2002-02-28 Doc-SIG post:
remove the “.. “, prefix a “_”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">Footnote</span> <span class="mi">1</span>
<span class="n">_</span><span class="p">[</span><span class="c1">#] Auto-numbered footnote.</span>
<span class="n">_</span><span class="p">[</span><span class="c1">#label] Auto-labeled footnote.</span>
</pre></div>
</div>
<p>The leading underscore syntax (earlier dropped because
<code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">_[1]:</span></code> was too verbose) is a useful reminder that footnotes
are hyperlink targets.</p>
</li>
<li><p>Minimal syntax: remove the “.. [” and “]”, prefix a “_”, and
suffix a “.”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>_1. Footnote 1.
_#. Auto-numbered footnote.
_#label. Auto-labeled footnote.

         ``_1.``, ``_#.``, and ``_#label.`` are markers,
         like list markers.
</pre></div>
</div>
<p>Footnotes could be rendered something like this in HTML</p>
<blockquote>
<div><div class="line-block">
<div class="line">1. This is a footnote.  The brackets could be dropped</div>
<div class="line-block">
<div class="line">from the label, and a vertical bar could set them</div>
<div class="line">off from the rest of the document in the HTML.</div>
</div>
</div>
</div></blockquote>
<p>Two-way hyperlinks on the footnote marker (“1.” above) would also
help to differentiate footnotes from enumerated lists.</p>
<p>If converted to endnotes (by a directive/transform), a horizontal
half-line might be used instead.  Page-oriented output formats
would typically use the horizontal line for true footnotes.</p>
</li>
</ul>
</li>
<li><p>Footnote references:</p>
<ul>
<li><p>Current syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="n">_</span><span class="p">,</span> <span class="p">[</span><span class="c1">#]_, [#label]_</span>
</pre></div>
</div>
</li>
<li><p>Minimal syntax to match the minimal footnote syntax above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="n">_</span><span class="p">,</span> <span class="c1">#_, #label_</span>
</pre></div>
</div>
<p>As a consequence, pure-numeric hyperlink references would not be
possible; they’d be interpreted as footnote references.</p>
</li>
</ul>
</li>
<li><p>Citation references: no change is proposed from the current footnote
reference syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">GVR2001</span><span class="p">]</span><span class="n">_</span>
</pre></div>
</div>
</li>
<li><p>Citations:</p>
<ul>
<li><p>Current syntax (footnote syntax):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="p">[</span><span class="n">GVR2001</span><span class="p">]</span> <span class="n">Python</span> <span class="n">Documentation</span><span class="p">;</span> <span class="n">van</span> <span class="n">Rossum</span><span class="p">,</span> <span class="n">Drake</span><span class="p">,</span> <span class="n">et</span> <span class="n">al</span><span class="o">.</span><span class="p">;</span>
   <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p>Possible new syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">[</span><span class="n">GVR2001</span><span class="p">]</span> <span class="n">Python</span> <span class="n">Documentation</span><span class="p">;</span> <span class="n">van</span> <span class="n">Rossum</span><span class="p">,</span> <span class="n">Drake</span><span class="p">,</span> <span class="n">et</span> <span class="n">al</span><span class="o">.</span><span class="p">;</span>
           <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span>

<span class="n">_</span><span class="p">[</span><span class="n">DJG2002</span><span class="p">]</span>
    <span class="n">Docutils</span><span class="p">:</span> <span class="n">Python</span> <span class="n">Documentation</span> <span class="n">Utilities</span> <span class="n">project</span><span class="p">;</span> <span class="n">Goodger</span>
    <span class="n">et</span> <span class="n">al</span><span class="o">.</span><span class="p">;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">docutils</span><span class="o">.</span><span class="n">sourceforge</span><span class="o">.</span><span class="n">net</span><span class="o">/</span>
</pre></div>
</div>
<p>Without the “.. ” marker, subsequent lines would either have to
align as in one of the above, or we’d have to allow loose
alignment (I’d rather not):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">[</span><span class="n">GVR2001</span><span class="p">]</span> <span class="n">Python</span> <span class="n">Documentation</span><span class="p">;</span> <span class="n">van</span> <span class="n">Rossum</span><span class="p">,</span> <span class="n">Drake</span><span class="p">,</span> <span class="n">et</span> <span class="n">al</span><span class="o">.</span><span class="p">;</span>
    <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<p>I proposed adopting the “minimal” syntax for footnotes and footnote
references, and adding citations and citation references to
reStructuredText’s repertoire.  The current footnote syntax for
citations is better than the alternatives given.</p>
<p>From a reply by Tony Ibbs on 2002-03-01:</p>
<blockquote>
<div><p>However, I think easier with examples, so let’s create one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Fans</span> <span class="n">of</span> <span class="n">Terry</span> <span class="n">Pratchett</span> <span class="n">are</span> <span class="n">perhaps</span> <span class="n">more</span> <span class="n">likely</span> <span class="n">to</span> <span class="n">use</span>
<span class="n">footnotes</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="n">_</span> <span class="ow">in</span> <span class="n">their</span> <span class="n">own</span> <span class="n">writings</span> <span class="n">than</span> <span class="n">other</span> <span class="n">people</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="n">_</span><span class="o">.</span>  <span class="n">Of</span> <span class="n">course</span><span class="p">,</span> <span class="ow">in</span> <span class="o">*</span><span class="n">general</span><span class="o">*</span><span class="p">,</span> <span class="n">one</span> <span class="n">only</span> <span class="n">sees</span> <span class="n">footnotes</span>
<span class="ow">in</span> <span class="n">academic</span> <span class="ow">or</span> <span class="n">technical</span> <span class="n">writing</span> <span class="o">-</span> <span class="n">it</span><span class="s1">&#39;s use in fiction</span>
<span class="ow">and</span> <span class="n">letter</span> <span class="n">writing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">normally</span> <span class="n">considered</span> <span class="n">good</span>
<span class="n">style</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="n">_</span><span class="p">,</span> <span class="n">particularly</span> <span class="ow">in</span> <span class="n">emails</span> <span class="p">(</span><span class="ow">not</span> <span class="n">a</span> <span class="n">medium</span> <span class="n">that</span>
<span class="n">lends</span> <span class="n">itself</span> <span class="n">to</span> <span class="n">footnotes</span><span class="p">)</span><span class="o">.</span>

<span class="o">..</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">That</span> <span class="ow">is</span><span class="p">,</span> <span class="n">little</span> <span class="n">bits</span> <span class="n">of</span> <span class="n">referenced</span> <span class="n">text</span> <span class="n">at</span> <span class="n">the</span>
   <span class="n">bottom</span> <span class="n">of</span> <span class="n">the</span> <span class="n">page</span><span class="o">.</span>
<span class="o">..</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">Because</span> <span class="n">Terry</span> <span class="n">himself</span> <span class="n">does</span><span class="p">,</span> <span class="n">of</span> <span class="n">course</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="n">_</span><span class="o">.</span>
<span class="o">..</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">Although</span> <span class="n">he</span> <span class="n">has</span> <span class="n">the</span> <span class="n">distinction</span> <span class="n">of</span> <span class="n">being</span>
   <span class="o">*</span><span class="n">funny</span><span class="o">*</span> <span class="n">when</span> <span class="n">he</span> <span class="n">does</span> <span class="n">it</span><span class="p">,</span> <span class="ow">and</span> <span class="n">his</span> <span class="n">fans</span> <span class="n">don</span><span class="s1">&#39;t always</span>
   <span class="n">achieve</span> <span class="n">that</span> <span class="n">aim</span><span class="o">.</span>
<span class="o">..</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">Presumably</span> <span class="n">because</span> <span class="n">it</span> <span class="n">detracts</span> <span class="kn">from</span> <span class="nn">linear</span>
   <span class="n">reading</span> <span class="n">of</span> <span class="n">the</span> <span class="n">text</span> <span class="o">-</span> <span class="n">this</span> <span class="ow">is</span><span class="p">,</span> <span class="n">of</span> <span class="n">course</span><span class="p">,</span> <span class="n">the</span> <span class="n">point</span><span class="o">.</span>
</pre></div>
</div>
<p>and look at it with the second syntax proposal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Fans</span> <span class="n">of</span> <span class="n">Terry</span> <span class="n">Pratchett</span> <span class="n">are</span> <span class="n">perhaps</span> <span class="n">more</span> <span class="n">likely</span> <span class="n">to</span> <span class="n">use</span>
<span class="n">footnotes</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="n">_</span> <span class="ow">in</span> <span class="n">their</span> <span class="n">own</span> <span class="n">writings</span> <span class="n">than</span> <span class="n">other</span> <span class="n">people</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="n">_</span><span class="o">.</span>  <span class="n">Of</span> <span class="n">course</span><span class="p">,</span> <span class="ow">in</span> <span class="o">*</span><span class="n">general</span><span class="o">*</span><span class="p">,</span> <span class="n">one</span> <span class="n">only</span> <span class="n">sees</span> <span class="n">footnotes</span>
<span class="ow">in</span> <span class="n">academic</span> <span class="ow">or</span> <span class="n">technical</span> <span class="n">writing</span> <span class="o">-</span> <span class="n">it</span><span class="s1">&#39;s use in fiction</span>
<span class="ow">and</span> <span class="n">letter</span> <span class="n">writing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">normally</span> <span class="n">considered</span> <span class="n">good</span>
<span class="n">style</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="n">_</span><span class="p">,</span> <span class="n">particularly</span> <span class="ow">in</span> <span class="n">emails</span> <span class="p">(</span><span class="ow">not</span> <span class="n">a</span> <span class="n">medium</span> <span class="n">that</span>
<span class="n">lends</span> <span class="n">itself</span> <span class="n">to</span> <span class="n">footnotes</span><span class="p">)</span><span class="o">.</span>

<span class="n">_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">That</span> <span class="ow">is</span><span class="p">,</span> <span class="n">little</span> <span class="n">bits</span> <span class="n">of</span> <span class="n">referenced</span> <span class="n">text</span> <span class="n">at</span> <span class="n">the</span>
     <span class="n">bottom</span> <span class="n">of</span> <span class="n">the</span> <span class="n">page</span><span class="o">.</span>
<span class="n">_</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">Because</span> <span class="n">Terry</span> <span class="n">himself</span> <span class="n">does</span><span class="p">,</span> <span class="n">of</span> <span class="n">course</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="n">_</span><span class="o">.</span>
<span class="n">_</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">Although</span> <span class="n">he</span> <span class="n">has</span> <span class="n">the</span> <span class="n">distinction</span> <span class="n">of</span> <span class="n">being</span>
     <span class="o">*</span><span class="n">funny</span><span class="o">*</span> <span class="n">when</span> <span class="n">he</span> <span class="n">does</span> <span class="n">it</span><span class="p">,</span> <span class="ow">and</span> <span class="n">his</span> <span class="n">fans</span> <span class="n">don</span><span class="s1">&#39;t always</span>
     <span class="n">achieve</span> <span class="n">that</span> <span class="n">aim</span><span class="o">.</span>
<span class="n">_</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">Presumably</span> <span class="n">because</span> <span class="n">it</span> <span class="n">detracts</span> <span class="kn">from</span> <span class="nn">linear</span>
     <span class="n">reading</span> <span class="n">of</span> <span class="n">the</span> <span class="n">text</span> <span class="o">-</span> <span class="n">this</span> <span class="ow">is</span><span class="p">,</span> <span class="n">of</span> <span class="n">course</span><span class="p">,</span> <span class="n">the</span> <span class="n">point</span><span class="o">.</span>
</pre></div>
</div>
<p>(I note here that if I have gotten the indentation of the
footnotes themselves correct, this is clearly not as nice.  And if
the indentation should be to the left margin instead, I like that
even less).</p>
<p>and the third (new) proposal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Fans</span> <span class="n">of</span> <span class="n">Terry</span> <span class="n">Pratchett</span> <span class="n">are</span> <span class="n">perhaps</span> <span class="n">more</span> <span class="n">likely</span> <span class="n">to</span> <span class="n">use</span>
<span class="n">footnotes</span> <span class="mi">1</span><span class="n">_</span> <span class="ow">in</span> <span class="n">their</span> <span class="n">own</span> <span class="n">writings</span> <span class="n">than</span> <span class="n">other</span> <span class="n">people</span>
<span class="mi">2</span><span class="n">_</span><span class="o">.</span>  <span class="n">Of</span> <span class="n">course</span><span class="p">,</span> <span class="ow">in</span> <span class="o">*</span><span class="n">general</span><span class="o">*</span><span class="p">,</span> <span class="n">one</span> <span class="n">only</span> <span class="n">sees</span> <span class="n">footnotes</span>
<span class="ow">in</span> <span class="n">academic</span> <span class="ow">or</span> <span class="n">technical</span> <span class="n">writing</span> <span class="o">-</span> <span class="n">it</span><span class="s1">&#39;s use in fiction</span>
<span class="ow">and</span> <span class="n">letter</span> <span class="n">writing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">normally</span> <span class="n">considered</span> <span class="n">good</span>
<span class="n">style</span> <span class="mi">4</span><span class="n">_</span><span class="p">,</span> <span class="n">particularly</span> <span class="ow">in</span> <span class="n">emails</span> <span class="p">(</span><span class="ow">not</span> <span class="n">a</span> <span class="n">medium</span> <span class="n">that</span>
<span class="n">lends</span> <span class="n">itself</span> <span class="n">to</span> <span class="n">footnotes</span><span class="p">)</span><span class="o">.</span>

<span class="n">_1</span><span class="o">.</span> <span class="n">That</span> <span class="ow">is</span><span class="p">,</span> <span class="n">little</span> <span class="n">bits</span> <span class="n">of</span> <span class="n">referenced</span> <span class="n">text</span> <span class="n">at</span> <span class="n">the</span>
    <span class="n">bottom</span> <span class="n">of</span> <span class="n">the</span> <span class="n">page</span><span class="o">.</span>
<span class="n">_2</span><span class="o">.</span> <span class="n">Because</span> <span class="n">Terry</span> <span class="n">himself</span> <span class="n">does</span><span class="p">,</span> <span class="n">of</span> <span class="n">course</span> <span class="mi">3</span><span class="n">_</span><span class="o">.</span>
<span class="n">_3</span><span class="o">.</span> <span class="n">Although</span> <span class="n">he</span> <span class="n">has</span> <span class="n">the</span> <span class="n">distinction</span> <span class="n">of</span> <span class="n">being</span>
    <span class="o">*</span><span class="n">funny</span><span class="o">*</span> <span class="n">when</span> <span class="n">he</span> <span class="n">does</span> <span class="n">it</span><span class="p">,</span> <span class="ow">and</span> <span class="n">his</span> <span class="n">fans</span> <span class="n">don</span><span class="s1">&#39;t always</span>
    <span class="n">achieve</span> <span class="n">that</span> <span class="n">aim</span><span class="o">.</span>
<span class="n">_4</span><span class="o">.</span> <span class="n">Presumably</span> <span class="n">because</span> <span class="n">it</span> <span class="n">detracts</span> <span class="kn">from</span> <span class="nn">linear</span>
    <span class="n">reading</span> <span class="n">of</span> <span class="n">the</span> <span class="n">text</span> <span class="o">-</span> <span class="n">this</span> <span class="ow">is</span><span class="p">,</span> <span class="n">of</span> <span class="n">course</span><span class="p">,</span> <span class="n">the</span> <span class="n">point</span><span class="o">.</span>
</pre></div>
</div>
<p>I think I don’t, in practice, mind the targets too much (the use
of a dot after the number helps a lot here), but I do have a
problem with the body text, in that I don’t naturally separate out
the footnotes as different than the rest of the text - instead I
keep wondering why there are numbers interspered in the text.  The
use of brackets around the numbers ([ and ]) made me somehow parse
the footnote references as “odd” - i.e., not part of the body text
- and thus both easier to skip, and also (paradoxically) easier to
pick out so that I could follow them.</p>
<p>Thus, for the moment (and as always susceptable to argument), I’d
say -1 on the new form of footnote reference (i.e., I much prefer
the existing <code class="docutils literal notranslate"><span class="pre">[1]_</span></code> over the proposed <code class="docutils literal notranslate"><span class="pre">1_</span></code>), and ambivalent
over the proposed target change.</p>
<p>That leaves David’s problem of wanting to distinguish footnotes
and citations - and the only thing I can propose there is that
footnotes are numeric or # and citations are not (which, as a
human being, I can probably cope with!).</p>
</div></blockquote>
<p>From a reply by Paul Moore on 2002-03-01:</p>
<blockquote>
<div><p>I think the current footnote syntax <code class="docutils literal notranslate"><span class="pre">[1]_</span></code> is <em>exactly</em> the
right balance of distinctness vs unobtrusiveness.  I very
definitely don’t think this should change.</p>
<p>On the target change, it doesn’t matter much to me.</p>
</div></blockquote>
<p>From a further reply by Tony Ibbs on 2002-03-01, referring to the
“[1]” form and actual usage in email:</p>
<blockquote>
<div><p>Clearly this is a form people are used to, and thus we should
consider it strongly (in the same way that the usage of <code class="docutils literal notranslate"><span class="pre">*..*</span></code>
to mean emphasis was taken partly from email practise).</p>
<p>Equally clearly, there is something “magical” for people in the
use of a similar form (i.e., <code class="docutils literal notranslate"><span class="pre">[1]</span></code>) for both footnote reference
and footnote target - it seems natural to keep them similar.</p>
<p>…</p>
<p>I think that this established plaintext usage leads me to strongly
believe we should retain square brackets at both ends of a
footnote.  The markup of the reference end (a single trailing
underscore) seems about as minimal as we can get away with.  The
markup of the target end depends on how one envisages the thing -
if “..” means “I am a target” (as I tend to see it), then that’s
good, but one can also argue that the “_[1]” syntax has a neat
symmetry with the footnote reference itself, if one wishes (in
which case “..” presumably means “hidden/special” as David seems
to think, which is why one needs a “..” <em>and</em> a leading underline
for hyperlink targets.</p>
</div></blockquote>
<p>Given the persuading arguments voiced, we’ll leave footnote &amp; footnote
reference syntax alone.  Except that these discussions gave rise to
the “auto-symbol footnote” concept, which has been added.  Citations
and citation references have also been added.</p>
</div>
<div class="section" id="syntax-for-questions-answers">
<h3><a class="toc-backref" href="#id47">Syntax for Questions &amp; Answers</a><a class="headerlink" href="#syntax-for-questions-answers" title="永久链接至标题">¶</a></h3>
<p>Implement as a generic two-column marked list?  As a standalone
(non-directive) construct?  (Is the markup ambiguous?)  Add support to
parts.contents?</p>
<p>New elements would be required.  Perhaps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!ELEMENT question_list (question_list_item+)&gt;
&lt;!ATTLIST question_list
    numbering  (none | local | global)
                        #IMPLIED
    start     NUMBER    #IMPLIED&gt;
&lt;!ELEMENT question_list_item (question, answer*)&gt;
&lt;!ELEMENT question %text.model;&gt;
&lt;!ELEMENT answer (%body.elements;)+&gt;
</pre></div>
</div>
<p>Originally I thought of implementing a Q&amp;A list with special syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Q: What am I?

A: You are a question-and-answer
   list.

Q: What are you?

A: I am the omniscient &quot;we&quot;.
</pre></div>
</div>
<p>Where each “Q” and “A” could also be numbered (e.g., “Q1”).  However,
a simple enumerated or bulleted list will do just fine for syntax.  A
directive could treat the list specially; e.g. the first paragraph
could be treated as a question, the remainder as the answer (multiple
answers could be represented by nested lists).  Without special
syntax, this directive becomes low priority.</p>
<p>As described in the <a class="reference external" href="http://docutils.sf.net/FAQ.html#how-can-i-mark-up-a-faq-or-other-list-of-questions-answers">FAQ</a>, no special syntax or directive is needed
for this application.</p>
</div>
</div>
<div class="section" id="tabled">
<h2><a class="toc-backref" href="#id48">Tabled</a><a class="headerlink" href="#tabled" title="永久链接至标题">¶</a></h2>
<div class="section" id="reworking-explicit-markup-round-2">
<h3><a class="toc-backref" href="#id49">Reworking Explicit Markup (Round 2)</a><a class="headerlink" href="#reworking-explicit-markup-round-2" title="永久链接至标题">¶</a></h3>
<p>See <a class="reference internal" href="#reworking-explicit-markup-round-1">Reworking Explicit Markup (Round 1)</a> for an earlier discussion.</p>
<p>In April 2004, a new thread becan on docutils-develop: <a class="reference external" href="http://thread.gmane.org/gmane.text.docutils.devel/1386">Inconsistency
in RST markup</a>.  Several arguments were made; the first argument
begat later arguments.  Below, the arguments are paraphrased “in
quotes”, with responses.</p>
<ol class="arabic">
<li><p>References and targets take this form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">targetname_</span>

<span class="o">..</span> <span class="n">_targetname</span><span class="p">:</span> <span class="n">stuff</span>
</pre></div>
</div>
<p>But footnotes, “which generate links just like targets do”, are
written as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="n">_</span>

<span class="o">..</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">stuff</span>
</pre></div>
</div>
<p>“Footnotes should be written as”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="n">_</span>

<span class="o">..</span> <span class="n">_</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">stuff</span>
</pre></div>
</div>
<p>But they’re not the same type of animal.  That’s not a “footnote
target”, it’s a <em>footnote</em>.  Being a target is not a footnote’s
primary purpose (an arguable point).  It just happens to grow a
target automatically, for convenience.  Just as a section title:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Title</span>
<span class="o">=====</span>
</pre></div>
</div>
<p>isn’t a “title target”, it’s a <em>title</em>, which happens to grow a
target automatically.  The consistency is there, it’s just deeper
than at first glance.</p>
<p>Also, “.. [1]” was chosen for footnote syntax because it closely
resembles one form of actual footnote rendering.  “.. _[1]:” is too
verbose; excessive punctuation is required to get the job done.</p>
<p>For more of the reasoning behind the syntax, see <a class="reference external" href="problems.html#hyperlinks">Problems With
StructuredText (Hyperlinks)</a> and
<a class="reference internal" href="#reworking-footnotes">Reworking Footnotes</a>.</p>
</li>
<li><p>“I expect directives to also look like <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">this:</span></code> [one colon]
because that also closely parallels the link and footnote target
markup.”</p>
<p>There are good reasons for the two-colon syntax:</p>
<blockquote>
<div><p>Two colons are used after the directive type for these reasons:</p>
<ul>
<li><p>Two colons are distinctive, and unlikely to be used in common
text.</p></li>
<li><p>Two colons avoids clashes with common comment text like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. Danger: modify at your own risk!
</pre></div>
</div>
</li>
<li><p>If an implementation of reStructuredText does not recognize a
directive (i.e., the directive-handler is not installed), a
level-3 (error) system message is generated, and the entire
directive block (including the directive itself) will be
included as a literal block.  Thus “::” is a natural choice.</p></li>
</ul>
<p class="attribution">—<a class="reference external" href="../../ref/rst/restructuredtext.html#directives">restructuredtext.html#directives</a></p>
</div></blockquote>
<p>The last reason is not particularly compelling; it’s more of a
convenient coincidence or mnemonic.</p>
</li>
<li><p>“Comments always seemed too easy.  I almost never write comments.
I’d have no problem writing ‘.. comment:’ in front of my comments.
In fact, it would probably be more readable, as comments <em>should</em>
be set off strongly, because they are very different from normal
text.”</p>
<p>Many people do use comments though, and some applications of
reStructuredText require it.  For example, all reStructuredText
PEPs (and this document!) have an Emacs stanza at the bottom, in a
comment.  Having to write “.. comment::” would be very obtrusive.</p>
<p>Comments <em>should</em> be dirt-easy to do.  It should be easy to
“comment out” a block of text.  Comments in programming languages
and other markup languages are invariably easy.</p>
<p>Any author is welcome to preface their comments with “Comment:” or
“Do Not Print” or “Note to Editor” or anything they like.  A
“comment” directive could easily be implemented.  It might be
confused with admonition directives, like “note” and “caution”
though.  In unrelated (and unpublished and unfinished) work, adding
a “comment” directive as a true document element was considered:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">If</span> <span class="n">structure</span> <span class="ow">is</span> <span class="n">necessary</span><span class="p">,</span> <span class="n">we</span> <span class="n">could</span> <span class="n">use</span> <span class="n">a</span> <span class="s2">&quot;comment&quot;</span> <span class="n">directive</span>
<span class="p">(</span><span class="n">to</span> <span class="n">avoid</span> <span class="n">nonsensical</span> <span class="n">DTD</span> <span class="n">changes</span><span class="p">,</span> <span class="n">the</span> <span class="s2">&quot;comment&quot;</span> <span class="n">directive</span>
<span class="n">could</span> <span class="n">produce</span> <span class="n">an</span> <span class="n">untitled</span> <span class="n">topic</span> <span class="n">element</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p>“One of the goals of reStructuredText is to be <em>readable</em> by people
who don’t know it.  This construction violates that: it is not at
all obvious to the uninitiated that text marked by ‘..’ is a
comment.  On the other hand, ‘.. comment:’ would be totally
transparent.”</p>
<p>Totally transparent, perhaps, but also very obtrusive.  Another of
<a class="reference external" href="../../ref/rst/introduction.html#goals">reStructuredText’s goals</a> is to be unobtrusive, and
“.. comment::” would violate that.  The goals of reStructuredText
are many, and they conflict.  Determining the right set of goals
and finding solutions that best fit is done on a case-by-case
basis.</p>
<p>Even readability is has two aspects.  Being readable without any
prior knowledge is one.  Being as easily read in raw form as in
processed form is the other.  “..” may not contribute to the former
aspect, but “.. comment::” would certainly detract from the latter.</p>
</li>
<li><p>“Recently I sent someone an rst document, and they got confused; I
had to explain to them that ‘..’ marks comments, <em>unless</em> it’s a
directive, etc…”</p>
<p>The explanation of directives <em>is</em> roundabout, defining comments in
terms of not being other things.  That’s definitely a wart.</p>
</li>
<li><p>“Under the current system, a mistyped directive (with ‘:’ instead
of ‘::’) will be silently ignored.  This is an error that could
easily go unnoticed.”</p>
<p>A parser option/setting like “–comments-on-stderr” would help.</p>
</li>
<li><p>“I’d prefer to see double-dot-space / command / double-colon as the
standard Docutils markup-marker.  It’s unusual enough to avoid
being accidently used.  Everything that starts with a double-dot
should end with a double-colon.”</p>
<p>That would increase the punctuation verbosity of some constructs
considerably.</p>
</li>
<li><p>Edward Loper proposed the following plan for backwards
compatibility:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>“.. foo” will generate a deprecation warning to stderr, and
nothing in the output (no system messages).</p></li>
<li><p>“.. foo: bar” will be treated as a directive foo.  If there
is no foo directive, then do the normal error output.</p></li>
<li><p>“.. foo:: bar” will generate a deprecation warning to
stderr, and be treated as a directive.  Or leave it valid?</p></li>
</ol>
<p>So some existing documents might start printing deprecation
warnings, but the only existing documents that would <em>break</em>
would be ones that say something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">warning</span><span class="p">:</span> <span class="n">this</span> <span class="n">should</span> <span class="n">be</span> <span class="n">a</span> <span class="n">comment</span>
</pre></div>
</div>
<p>instead of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">warning</span><span class="p">::</span> <span class="n">this</span> <span class="n">should</span> <span class="n">be</span> <span class="n">a</span> <span class="n">comment</span>
</pre></div>
</div>
<p>Here, we’re trading fairly common a silent error (directive
falsely treated as a comment) for a fairly uncommon explicitly
flagged error (comment falsely treated as directive).  To make
things even easier, we could add a sentence to the
unknown-directive error.  Something like “If you intended to
create a comment, please use ‘.. comment:’ instead”.</p>
</div></blockquote>
</li>
</ol>
<p>On one hand, I understand and sympathize with the points raised.  On
the other hand, I think the current syntax strikes the right balance
(but I acknowledge a possible lack of objectivity).  On the gripping
hand, the comment and directive syntax has become well established, so
even if it’s a wart, it may be a wart we have to live with.</p>
<p>Making any of these changes would cause a lot of breakage or at least
deprecation warnings.  I’m not sure the benefit is worth the cost.</p>
<p>For now, we’ll treat this as an unresolved legacy issue.</p>
</div>
</div>
<div class="section" id="to-do">
<h2><a class="toc-backref" href="#id50">To Do</a><a class="headerlink" href="#to-do" title="永久链接至标题">¶</a></h2>
<div class="section" id="nested-inline-markup">
<h3><a class="toc-backref" href="#id51">Nested Inline Markup</a><a class="headerlink" href="#nested-inline-markup" title="永久链接至标题">¶</a></h3>
<p>These are collected notes on a long-discussed issue.  The original
mailing list messages should be referred to for details.</p>
<ul>
<li><p>In a 2001-10-31 discussion I wrote:</p>
<blockquote>
<div><p>Try, for example, <a class="reference external" href="http://mail.python.org/pipermail/doc-sig/2001-March/001487.html">Ed Loper’s 2001-03-21 post</a>, which details
some rules for nested inline markup. I think the complexity is
prohibitive for the marginal benefit. (And if you can understand
that tree without going mad, you’re a better man than I. ;-)</p>
<p>Inline markup is already fragile. Allowing nested inline markup
would only be asking for trouble IMHO. If it proves absolutely
necessary, it can be added later. The rules for what can appear
inside what must be well thought out first though.</p>
<p class="attribution">—<a class="reference external" href="http://mail.python.org/pipermail/doc-sig/2001-October/002354.html">http://mail.python.org/pipermail/doc-sig/2001-October/002354.html</a></p>
</div></blockquote>
</li>
<li><p>In a 2001-11-09 Doc-SIG post, I wrote:</p>
<blockquote>
<div><p>The problem is that in the
what-you-see-is-more-or-less-what-you-get markup language that
is reStructuredText, the symbols used for inline markup (“*”,
“**”, “`”, “``”, etc.) may preclude nesting.</p>
</div></blockquote>
<p>I’ve rethought this position.  Nested markup is not precluded, just
tricky.  People and software parse “double and ‘single’ quotes” all
the time.  Continuing,</p>
<blockquote>
<div><p>I’ve thought over how we might implement nested inline
markup. The first algorithm (“first identify the outer inline
markup as we do now, then recursively scan for nested inline
markup”) won’t work; counterexamples were given in my <a class="reference external" href="http://mail.python.org/pipermail/doc-sig/2001-November/002363.html">last post</a>.</p>
<p>The second algorithm makes my head hurt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">scan</span> <span class="k">for</span> <span class="n">start</span><span class="o">-</span><span class="n">string</span>
    <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
        <span class="n">push</span> <span class="n">on</span> <span class="n">stack</span>
        <span class="n">scan</span> <span class="k">for</span> <span class="n">start</span> <span class="ow">or</span> <span class="n">end</span> <span class="n">string</span>
        <span class="k">if</span> <span class="n">new</span> <span class="n">start</span> <span class="n">string</span> <span class="n">found</span><span class="p">:</span>
            <span class="n">recurse</span>
        <span class="k">elif</span> <span class="n">matching</span> <span class="n">end</span> <span class="n">string</span> <span class="n">found</span><span class="p">:</span>
            <span class="n">pop</span> <span class="n">stack</span>
        <span class="k">elif</span> <span class="n">non</span><span class="o">-</span><span class="n">matching</span> <span class="n">end</span> <span class="n">string</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">its</span> <span class="n">a</span> <span class="n">markup</span> <span class="n">error</span><span class="p">:</span>
                <span class="n">generate</span> <span class="n">warning</span>
            <span class="k">elif</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">start</span><span class="o">-</span><span class="n">string</span> <span class="n">was</span> <span class="n">misinterpreted</span><span class="p">:</span>
                <span class="c1"># e.g. in this case: ***strong** in emphasis*</span>
                <span class="n">restart</span> <span class="k">with</span> <span class="n">the</span> <span class="n">other</span> <span class="n">interpretation</span>
                <span class="c1"># but it might be several layers back ...</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This is similar to how the parser does section title
recognition, but sections are much more regular and
deterministic.</p>
<p>Bottom line is, I don’t think the benefits are worth the effort,
even if it is possible. I’m not going to try to write the code,
at least not now. If somebody codes up a consistent, working,
general solution, I’ll be happy to consider it.</p>
<p class="attribution">—<a class="reference external" href="http://mail.python.org/pipermail/doc-sig/2001-November/002388.html">http://mail.python.org/pipermail/doc-sig/2001-November/002388.html</a></p>
</div></blockquote>
</li>
<li><p>In a <a class="reference external" href="http://article.gmane.org/gmane.text.docutils.user/317">2003-05-06 Docutils-Users post</a> Paul Tremblay proposed a new
syntax to allow for easier nesting.  It eventually evolved into
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="n">role</span><span class="p">:[</span><span class="n">inline</span> <span class="n">text</span><span class="p">]</span>
</pre></div>
</div>
<p>The duplication with the existing interpreted text syntax is
problematic though.</p>
</li>
<li><p>Could the parser be extended to parse nested interpreted text?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>:emphasis:`Some emphasized text with :strong:`some more
emphasized text` in it and **perhaps** :reference:`a link``
</pre></div>
</div>
</li>
<li><p>In a <a class="reference external" href="http://article.gmane.org/gmane.text.docutils.devel/795">2003-06-18 Docutils-Develop post</a>, Mark Nodine reported on
his implementation of a form of nested inline markup in his
Perl-based parser (unpublished).  He brought up some interesting
ideas.  The implementation was flawed, however, by the change in
semantics required for backslash escapes.</p>
</li>
<li><p>Docutils-develop threads between David Abrahams, David Goodger, and
Mark Nodine (beginning <a class="reference external" href="http://thread.gmane.org/gmane.text.docutils.devel/1102">2004-01-16</a> and <a class="reference external" href="http://thread.gmane.org/gmane.text.docutils.devel/1125">2004-01-19</a>) hashed out
many of the details of a potentially successful implementation, as
described below.  David Abrahams checked in code to the “nesting”
branch of CVS, awaiting thorough review.</p>
</li>
</ul>
<p>It may be possible to accomplish nested inline markup in general with
a more powerful inline markup parser.  There may be some issues, but
I’m not averse to the idea of nested inline markup in general.  I just
don’t have the time or inclination to write a new parser now.  Of
course, a good patch would be welcome!</p>
<p>I envisage something like this.  Explicit-role interpreted text must
be nestable.  Prefix-based is probably preferred, since suffix-based
will look like inline literals:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>``text`:role1:`:role2:
</pre></div>
</div>
<p>But it can be disambiguated, so it ought to be left up to the author:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`\ `text`:role1:`:role2:
</pre></div>
</div>
<p>In addition, other forms of inline markup may be nested if
unambiguous:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*emphasized ``literal`` and |substitution ref| and link_*
</pre></div>
</div>
<p>IOW, the parser ought to be as permissive as possible.</p>
</div>
<div class="section" id="index-entries-indexes">
<h3><a class="toc-backref" href="#id52">Index Entries &amp; Indexes</a><a class="headerlink" href="#index-entries-indexes" title="永久链接至标题">¶</a></h3>
<p>Were I writing a book with an index, I guess I’d need two
different kinds of index targets: inline/implicit and
out-of-line/explicit.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>In this `paragraph`:index:, several words are being
`marked`:index: inline as implicit `index`:index:
entries.

.. index:: markup
.. index:: syntax

The explicit index directives above would refer to
this paragraph.  It might also make sense to allow multiple
entries in an ``index`` directive:

.. index::
    markup
    syntax
</pre></div>
</div>
<p>The words “paragraph”, “marked”, and “index” would become index
entries pointing at the words in the first paragraph.  The index
entry words appear verbatim in the text.  (Don’t worry about the
ugly “:index:” part; if indexing is the only/main application of
interpreted text in your documents, it can be implicit and
omitted.)  The two directives provide manual indexing, where the
index entry words (“markup” and “syntax”) do not appear in the
main text.  We could combine the two directives into one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">index</span><span class="p">::</span> <span class="n">markup</span><span class="p">;</span> <span class="n">syntax</span>
</pre></div>
</div>
<p>Semicolons instead of commas because commas could <em>be</em> part of the
index target, like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">index</span><span class="p">::</span> <span class="n">van</span> <span class="n">Rossum</span><span class="p">,</span> <span class="n">Guido</span>
</pre></div>
</div>
<p>Another reason for index directives is because other inline markup
wouldn’t be possible within inline index targets.</p>
<p>Sometimes index entries have multiple levels.  Given:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">index</span><span class="p">::</span> <span class="n">statement</span> <span class="n">syntax</span><span class="p">:</span> <span class="n">expression</span> <span class="n">statements</span>
</pre></div>
</div>
<p>In a hypothetical index, combined with other entries, it might
look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">statement</span> <span class="n">syntax</span>
    <span class="n">expression</span> <span class="n">statements</span> <span class="o">.....</span> <span class="mi">56</span>
    <span class="n">assignment</span> <span class="o">................</span> <span class="mi">57</span>
    <span class="n">simple</span> <span class="n">statements</span> <span class="o">.........</span> <span class="mi">58</span>
    <span class="n">compound</span> <span class="n">statements</span> <span class="o">.......</span> <span class="mi">60</span>
</pre></div>
</div>
<p>Inline multi-level index targets could be done too.  Perhaps
something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>When dealing with `expression statements &lt;statement syntax:&gt;`,
we must remember ...
</pre></div>
</div>
<p>The opposite sense could also be possible:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>When dealing with `index entries &lt;:multi-level&gt;`, there are
many permutations to consider.
</pre></div>
</div>
<p>Also “see / see also” index entries.</p>
<p>Given:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Here</span><span class="s1">&#39;s a paragraph.</span>

<span class="o">..</span> <span class="n">index</span><span class="p">::</span> <span class="n">paragraph</span>
</pre></div>
</div>
<p>(The “index” directive above actually targets the <em>preceding</em>
object.)  The directive should produce something like this XML:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">paragraph</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">index_entry</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;paragraph&quot;</span><span class="o">/&gt;</span>
<span class="n">Here</span><span class="s1">&#39;s a paragraph.</span>
<span class="o">&lt;/</span><span class="n">paragraph</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This kind of content model would also allow true inline
index-entries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Here</span><span class="s1">&#39;s a `paragraph`:index:.</span>
</pre></div>
</div>
<p>If the “index” role were the default for the application, it could be
dropped:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Here</span><span class="s1">&#39;s a `paragraph`.</span>
</pre></div>
</div>
<p>Both of these would result in this XML:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">paragraph</span><span class="o">&gt;</span>
<span class="n">Here</span><span class="s1">&#39;s a &lt;index_entry&gt;paragraph&lt;/index_entry&gt;.</span>
<span class="o">&lt;/</span><span class="n">paragraph</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="section" id="from-2002-06-24-docutils-develop-posts">
<h4><a class="toc-backref" href="#id53">from 2002-06-24 docutils-develop posts</a><a class="headerlink" href="#from-2002-06-24-docutils-develop-posts" title="永久链接至标题">¶</a></h4>
<blockquote>
<div><p>If all of your index entries will appear verbatim in the text,
this should be sufficient.  If not (e.g., if you want “Van Rossum,
Guido” in the index but “Guido van Rossum” in the text), we’ll
have to figure out a supplemental mechanism, perhaps using
substitutions.</p>
</div></blockquote>
<p>I’ve thought a bit more on this, and I came up with two possibilities:</p>
<ol class="arabic">
<li><p>Using interpreted text, embed the index entry text within the
interpreted text:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>... by `Guido van Rossum [Van Rossum, Guido]` ...
</pre></div>
</div>
<p>The problem with this is obvious: the text becomes cluttered and
hard to read.  The processed output would drop the text in
brackets, which goes against the spirit of interpreted text.</p>
</li>
<li><p>Use substitutions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> <span class="n">by</span> <span class="o">|</span><span class="n">Guido</span> <span class="n">van</span> <span class="n">Rossum</span><span class="o">|</span> <span class="o">...</span>

<span class="o">..</span> <span class="o">|</span><span class="n">Guido</span> <span class="n">van</span> <span class="n">Rossum</span><span class="o">|</span> <span class="n">index</span><span class="p">::</span> <span class="n">Van</span> <span class="n">Rossum</span><span class="p">,</span> <span class="n">Guido</span>
</pre></div>
</div>
<p>A problem with this is that each substitution definition must have
a unique name.  A subsequent <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">|Guido</span> <span class="pre">van</span> <span class="pre">Rossum|</span> <span class="pre">index::</span> <span class="pre">BDFL</span></code>
would be illegal.  Some kind of anonymous substitution definition
mechanism would be required, but I think that’s going too far.</p>
</li>
</ol>
<p>Both of these alternatives are flawed.  Any other ideas?</p>
</div>
</div>
</div>
<div class="section" id="or-not-to-do">
<h2><a class="toc-backref" href="#id54">… Or Not To Do?</a><a class="headerlink" href="#or-not-to-do" title="永久链接至标题">¶</a></h2>
<p>This is the realm of the possible but questionably probable.  These
ideas are kept here as a record of what has been proposed, for
posterity and in case any of them prove to be useful.</p>
<div class="section" id="compound-enumerated-lists">
<h3><a class="toc-backref" href="#id55">Compound Enumerated Lists</a><a class="headerlink" href="#compound-enumerated-lists" title="永久链接至标题">¶</a></h3>
<p>Allow for compound enumerators, such as “1.1.” or “1.a.” or “1(a)”, to
allow for nested enumerated lists without indentation?</p>
</div>
<div class="section" id="indented-lists">
<h3><a class="toc-backref" href="#id56">Indented Lists</a><a class="headerlink" href="#indented-lists" title="永久链接至标题">¶</a></h3>
<p>Allow for variant styles by interpreting indented lists as if they
weren’t indented?  For example, currently the list below will be
parsed as a list within a block quote:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">paragraph</span>

  <span class="o">*</span> <span class="nb">list</span> <span class="n">item</span> <span class="mi">1</span>
  <span class="o">*</span> <span class="nb">list</span> <span class="n">item</span> <span class="mi">2</span>
</pre></div>
</div>
<p>But a lot of people seem to write that way, and HTML browsers make it
look as if that’s the way it should be.  The parser could check the
contents of block quotes, and if they contain only a single list,
remove the block quote wrapper.  There would be two problems:</p>
<ol class="arabic simple">
<li><p>What if we actually <em>do</em> want a list inside a block quote?</p></li>
<li><p>What if such a list comes immediately after an indented construct,
such as a literal block?</p></li>
</ol>
<p>Both could be solved using empty comments (problem 2 already exists
for a block quote after a literal block).  But that’s a hack.</p>
<p>Perhaps a runtime setting, allowing or disabling this convenience,
would be appropriate.  But that raises issues too:</p>
<blockquote>
<div><p>User A, who writes lists indented (and their config file is set up
to allow it), sends a file to user B, who doesn’t (and their
config file disables indented lists).  The result of processing by
the two users will be different.</p>
</div></blockquote>
<p>It may seem minor, but it adds ambiguity to the parser, which is bad.</p>
<p>See the <a class="reference external" href="http://mail.python.org/pipermail/doc-sig/2001-April/001776.html">Doc-SIG discussion starting 2001-04-18</a> with Ed Loper’s
“Structuring: a summary; and an attempt at EBNF”, item 4 (and
follow-ups, <a class="reference external" href="http://mail.python.org/pipermail/doc-sig/2001-April/001789.html">here</a> and <a class="reference external" href="http://mail.python.org/pipermail/doc-sig/2001-April/001793.html">here</a>).  Also <a class="reference external" href="http://sourceforge.net/mailarchive/message.php?msg_id=3838913">docutils-users, 2003-02-17</a>
and <a class="reference external" href="http://sf.net/mailarchive/forum.php?thread_id=2957175&amp;forum_id=11444">beginning 2003-08-04</a>.</p>
</div>
<div class="section" id="sloppy-indentation-of-list-items">
<h3><a class="toc-backref" href="#id57">Sloppy Indentation of List Items</a><a class="headerlink" href="#sloppy-indentation-of-list-items" title="永久链接至标题">¶</a></h3>
<p>Perhaps the indentation shouldn’t be so strict.  Currently, this is
required:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">First</span> <span class="n">line</span><span class="p">,</span>
   <span class="n">second</span> <span class="n">line</span><span class="o">.</span>
</pre></div>
</div>
<p>Anything wrong with this?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">First</span> <span class="n">line</span><span class="p">,</span>
 <span class="n">second</span> <span class="n">line</span><span class="o">.</span>
</pre></div>
</div>
<p>Problem?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. First para.

   Block quote.  (no good: requires some indent relative to first
   para)

 Second Para.

2. Have to carefully define where the literal block ends::

     Literal block

   Literal block?
</pre></div>
</div>
<p>Hmm…  Non-strict indentation isn’t such a good idea.</p>
</div>
<div class="section" id="lazy-indentation-of-list-items">
<h3><a class="toc-backref" href="#id58">Lazy Indentation of List Items</a><a class="headerlink" href="#lazy-indentation-of-list-items" title="永久链接至标题">¶</a></h3>
<p>Another approach: Going back to the first draft of reStructuredText
(2000-11-27 post to Doc-SIG):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">fourth</span> <span class="n">item</span> <span class="n">of</span> <span class="n">the</span> <span class="n">main</span> <span class="nb">list</span> <span class="p">(</span><span class="n">no</span> <span class="n">blank</span> <span class="n">line</span> <span class="n">above</span><span class="p">)</span><span class="o">.</span>
<span class="n">The</span> <span class="n">second</span> <span class="n">line</span> <span class="n">of</span> <span class="n">this</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">indented</span> <span class="n">relative</span> <span class="n">to</span> <span class="n">the</span>
<span class="n">bullet</span><span class="p">,</span> <span class="n">which</span> <span class="n">precludes</span> <span class="n">it</span> <span class="kn">from</span> <span class="nn">having</span> <span class="n">a</span> <span class="n">second</span> <span class="n">paragraph</span><span class="o">.</span>
</pre></div>
</div>
<p>Change that to <em>require</em> a blank line above and below, to reduce
ambiguity.  This “loosening” may be added later, once the parser’s
been nailed down.  However, a serious drawback of this approach is to
limit the content of each list item to a single paragraph.</p>
<div class="section" id="david-s-idea-for-lazy-indentation">
<h4><a class="toc-backref" href="#id59">David’s Idea for Lazy Indentation</a><a class="headerlink" href="#david-s-idea-for-lazy-indentation" title="永久链接至标题">¶</a></h4>
<p>Consider a paragraph in a word processor.  It is a single logical line
of text which ends with a newline, soft-wrapped arbitrarily at the
right edge of the page or screen.  We can think of a plaintext
paragraph in the same way, as a single logical line of text, ending
with two newlines (a blank line) instead of one, and which may contain
arbitrary line breaks (newlines) where it was accidentally
hard-wrapped by an application.  We can compensate for the accidental
hard-wrapping by “unwrapping” every unindented second and subsequent
line.  The indentation of the first line of a paragraph or list item
would determine the indentation for the entire element.  Blank lines
would be required between list items when using lazy indentation.</p>
<p>The following example shows the lazy indentation of multiple body
elements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">first</span> <span class="n">paragraph</span>
<span class="n">of</span> <span class="n">the</span> <span class="n">first</span> <span class="nb">list</span> <span class="n">item</span><span class="o">.</span>

  <span class="n">Here</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">second</span> <span class="n">paragraph</span>
<span class="n">of</span> <span class="n">the</span> <span class="n">first</span> <span class="nb">list</span> <span class="n">item</span><span class="o">.</span>

<span class="o">-</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">first</span> <span class="n">paragraph</span>
<span class="n">of</span> <span class="n">the</span> <span class="n">second</span> <span class="nb">list</span> <span class="n">item</span><span class="o">.</span>

  <span class="n">Here</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">second</span> <span class="n">paragraph</span>
<span class="n">of</span> <span class="n">the</span> <span class="n">second</span> <span class="nb">list</span> <span class="n">item</span><span class="o">.</span>
</pre></div>
</div>
<p>A more complex example shows the limitations of lazy indentation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">first</span> <span class="n">paragraph</span>
<span class="n">of</span> <span class="n">the</span> <span class="n">first</span> <span class="nb">list</span> <span class="n">item</span><span class="o">.</span>

  <span class="n">Next</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">definition</span> <span class="nb">list</span> <span class="n">item</span><span class="p">:</span>

  <span class="n">Term</span>
      <span class="n">Definition</span><span class="o">.</span>  <span class="n">The</span> <span class="n">indentation</span> <span class="n">of</span> <span class="n">the</span> <span class="n">term</span> <span class="ow">is</span>
<span class="n">required</span><span class="p">,</span> <span class="k">as</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">indentation</span> <span class="n">of</span> <span class="n">the</span> <span class="n">definition</span><span class="s1">&#39;s</span>
<span class="n">first</span> <span class="n">line</span><span class="o">.</span>

      <span class="n">When</span> <span class="n">the</span> <span class="n">definition</span> <span class="n">extends</span> <span class="n">to</span> <span class="n">more</span> <span class="n">than</span>
<span class="n">one</span> <span class="n">line</span><span class="p">,</span> <span class="n">lazy</span> <span class="n">indentation</span> <span class="n">may</span> <span class="n">occur</span><span class="o">.</span>  <span class="p">(</span><span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">second</span>
<span class="n">paragraph</span> <span class="n">of</span> <span class="n">the</span> <span class="n">definition</span><span class="o">.</span><span class="p">)</span>

<span class="o">-</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">first</span> <span class="n">paragraph</span>
<span class="n">of</span> <span class="n">the</span> <span class="n">second</span> <span class="nb">list</span> <span class="n">item</span><span class="o">.</span>

  <span class="o">-</span> <span class="n">Here</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">first</span> <span class="n">paragraph</span> <span class="n">of</span>
<span class="n">the</span> <span class="n">first</span> <span class="n">item</span> <span class="n">of</span> <span class="n">a</span> <span class="n">nested</span> <span class="nb">list</span><span class="o">.</span>

  <span class="n">So</span> <span class="n">this</span> <span class="n">paragraph</span> <span class="n">would</span> <span class="n">be</span> <span class="n">outside</span> <span class="n">of</span> <span class="n">the</span> <span class="n">nested</span> <span class="nb">list</span><span class="p">,</span>
<span class="n">but</span> <span class="n">inside</span> <span class="n">the</span> <span class="n">second</span> <span class="nb">list</span> <span class="n">item</span> <span class="n">of</span> <span class="n">the</span> <span class="n">outer</span> <span class="nb">list</span><span class="o">.</span>

<span class="n">But</span> <span class="n">this</span> <span class="n">paragraph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">part</span> <span class="n">of</span> <span class="n">the</span> <span class="nb">list</span> <span class="n">at</span> <span class="nb">all</span><span class="o">.</span>
</pre></div>
</div>
<p>And the ambiguity remains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>- Look at the hyphen at the beginning of the next line
- is it a second list item marker, or a dash in the text?

Similarly, we may want to refer to numbers inside enumerated
lists:

1. How many socks in a pair? There are
2. How many pants in a pair? Exactly
1. Go figure.
</pre></div>
</div>
<p>Literal blocks and block quotes would still require consistent
indentation for all their lines.  For block quotes, we might be able
to get away with only requiring that the first line of each contained
element be indented.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Here</span><span class="s1">&#39;s a paragraph.</span>

    <span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">paragraph</span> <span class="n">inside</span> <span class="n">a</span> <span class="n">block</span> <span class="n">quote</span><span class="o">.</span>
<span class="n">Second</span> <span class="ow">and</span> <span class="n">subsequent</span> <span class="n">lines</span> <span class="n">need</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">indented</span> <span class="n">at</span> <span class="nb">all</span><span class="o">.</span>

    <span class="o">-</span> <span class="n">A</span> <span class="n">bullet</span> <span class="nb">list</span> <span class="n">inside</span>
<span class="n">the</span> <span class="n">block</span> <span class="n">quote</span><span class="o">.</span>

      <span class="n">Second</span> <span class="n">paragraph</span> <span class="n">of</span> <span class="n">the</span>
<span class="n">bullet</span> <span class="nb">list</span> <span class="n">inside</span> <span class="n">the</span> <span class="n">block</span> <span class="n">quote</span><span class="o">.</span>
</pre></div>
</div>
<p>Although feasible, this form of lazy indentation has problems.  The
document structure and hierarchy is not obvious from the indentation,
making the source plaintext difficult to read.  This will also make
keeping track of the indentation while writing difficult and
error-prone.  However, these problems may be acceptable for Wikis and
email mode, where we may be able to rely on less complex structure
(few nested lists, for example).</p>
</div>
</div>
<div class="section" id="multiple-roles-in-interpreted-text">
<h3><a class="toc-backref" href="#id60">Multiple Roles in Interpreted Text</a><a class="headerlink" href="#multiple-roles-in-interpreted-text" title="永久链接至标题">¶</a></h3>
<p>In reStructuredText, inline markup cannot be nested (yet; <a class="reference internal" href="#nested-inline-markup">see
above</a>).  This also applies to interpreted text.  In order to
simultaneously combine multiple roles for a single piece of text, a
syntax extension would be necessary.  Ideas:</p>
<ol class="arabic">
<li><p>Initial idea:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`interpreted text`:role1,role2:
</pre></div>
</div>
</li>
<li><p>Suggested by Jason Diamond:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`interpreted text`:role1:role2:
</pre></div>
</div>
</li>
</ol>
<p>If a document is so complex as to require nested inline markup,
perhaps another markup system should be considered.  By design,
reStructuredText does not have the flexibility of XML.</p>
</div>
<div class="section" id="parameterized-interpreted-text">
<h3><a class="toc-backref" href="#id61">Parameterized Interpreted Text</a><a class="headerlink" href="#parameterized-interpreted-text" title="永久链接至标题">¶</a></h3>
<p>In some cases it may be expedient to pass parameters to interpreted
text, analogous to function calls.  Ideas:</p>
<ol class="arabic">
<li><p>Parameterize the interpreted text role itself (suggested by Jason
Diamond):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`interpreted text`:role1(foo=bar):
</pre></div>
</div>
<p>Positional parameters could also be supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`CSS`:acronym(Cascading Style Sheets): is used for HTML, and
`CSS`:acronym(Content Scrambling System): is used for DVDs.
</pre></div>
</div>
<p>Technical problem: current interpreted text syntax does not
recognize roles containing whitespace.  Design problem: this smells
like programming language syntax, but reStructuredText is not a
programming language.</p>
</li>
<li><p>Put the parameters inside the interpreted text:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`CSS (Cascading Style Sheets)`:acronym: is used for HTML, and
`CSS (Content Scrambling System)`:acronym: is used for DVDs.
</pre></div>
</div>
<p>Although this could be defined on an individual basis (per role),
we ought to have a standard.  Hyperlinks with embedded URIs already
use angle brackets; perhaps they could be used here too:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`CSS &lt;Cascading Style Sheets&gt;`:acronym: is used for HTML, and
`CSS &lt;Content Scrambling System&gt;`:acronym: is used for DVDs.
</pre></div>
</div>
<p>Do angle brackets connote URLs too much for this to be acceptable?
How about the “tag” connotation – does it save them or doom them?</p>
</li>
<li><p><a class="reference internal" href="#nested-inline-markup">Nested inline markup</a> could prove useful here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`CSS :def:`Cascading Style Sheets``:acronym: is used for HTML,
and `CSS :def:`Content Scrambling System``:acronym: is used for
DVDs.
</pre></div>
</div>
<p>Inline markup roles could even define the default roles of nested
inline markup, allowing this cleaner syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`CSS `Cascading Style Sheets``:acronym: is used for HTML, and
`CSS `Content Scrambling System``:acronym: is used for DVDs.
</pre></div>
</div>
</li>
</ol>
<p>Does this push inline markup too far?  Readability becomes a serious
issue.  Substitutions may provide a better alternative (at the expense
of verbosity and duplication) by pulling the details out of the text
flow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span><span class="n">CSS</span><span class="o">|</span> <span class="ow">is</span> <span class="n">used</span> <span class="k">for</span> <span class="n">HTML</span><span class="p">,</span> <span class="ow">and</span> <span class="o">|</span><span class="n">CSS</span><span class="o">-</span><span class="n">DVD</span><span class="o">|</span> <span class="ow">is</span> <span class="n">used</span> <span class="k">for</span> <span class="n">DVDs</span><span class="o">.</span>

<span class="o">..</span> <span class="o">|</span><span class="n">CSS</span><span class="o">|</span> <span class="n">acronym</span><span class="p">::</span> <span class="n">Cascading</span> <span class="n">Style</span> <span class="n">Sheets</span>
<span class="o">..</span> <span class="o">|</span><span class="n">CSS</span><span class="o">-</span><span class="n">DVD</span><span class="o">|</span> <span class="n">acronym</span><span class="p">::</span> <span class="n">Content</span> <span class="n">Scrambling</span> <span class="n">System</span>
   <span class="p">:</span><span class="n">text</span><span class="p">:</span> <span class="n">CSS</span>
</pre></div>
</div>
<hr class="docutils" />
<p>This whole idea may be going beyond the scope of reStructuredText.
Documents requiring this functionality may be better off using XML or
another markup system.</p>
<p>This argument comes up regularly when pushing the envelope of
reStructuredText syntax.  I think it’s a useful argument in that it
provides a check on creeping featurism.  In many cases, the resulting
verbosity produces such unreadable plaintext that there’s a natural
desire <em>not</em> to use it unless absolutely necessary.  It’s a matter of
finding the right balance.</p>
</div>
<div class="section" id="syntax-for-interpreted-text-role-bindings">
<h3><a class="toc-backref" href="#id62">Syntax for Interpreted Text Role Bindings</a><a class="headerlink" href="#syntax-for-interpreted-text-role-bindings" title="永久链接至标题">¶</a></h3>
<p>The following syntax (idea from Jeffrey C. Jacobs) could be used to
associate directives with roles:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. :rewrite: class:: rewrite

`She wore ribbons in her hair and it lay with streaks of
grey`:rewrite:
</pre></div>
</div>
<p>The syntax is similar to that of substitution declarations, and the
directive/role association may resolve implementation issues.  The
semantics, ramifications, and implementation details would need to be
worked out.</p>
<p>The example above would implement the “rewrite” role as adding a
<code class="docutils literal notranslate"><span class="pre">class=&quot;rewrite&quot;</span></code> attribute to the interpreted text (“inline”
element).  The stylesheet would then pick up on the “class” attribute
to do the actual formatting.</p>
<p>The advantage of the new syntax would be flexibility.  Uses other than
“class” may present themselves.  The disadvantage is complexity:
having to implement new syntax for a relatively specialized operation,
and having new semantics in existing directives (“class::” would do
something different).</p>
<p>The <a class="reference external" href="../../ref/rst/directives.html#role">“role” directive</a> has been implemented.</p>
</div>
<div class="section" id="character-processing">
<h3><a class="toc-backref" href="#id63">Character Processing</a><a class="headerlink" href="#character-processing" title="永久链接至标题">¶</a></h3>
<p>Several people have suggested adding some form of character processing
to reStructuredText:</p>
<ul class="simple">
<li><p>Some sort of automated replacement of ASCII sequences:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--</span></code> to em-dash (or <code class="docutils literal notranslate"><span class="pre">--</span></code> to en-dash, and <code class="docutils literal notranslate"><span class="pre">---</span></code> to em-dash).</p></li>
<li><p>Convert quotes to curly quote entities.  (Essentially impossible
for HTML?  Unnecessary for TeX.)</p></li>
<li><p>Various forms of <code class="docutils literal notranslate"><span class="pre">:-)</span></code> to smiley icons.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;\</span> <span class="pre">&quot;</span></code> to &amp;nbsp;.  Problem with line-wrapping though: it could
end up escaping the newline.</p></li>
<li><p>Escaped newlines to &lt;BR&gt;.</p></li>
<li><p>Escaped period or quote or dash as a disappearing catalyst to
allow character-level inline markup?</p></li>
</ul>
</li>
<li><p>XML-style character entities, such as “&amp;copy;” for the copyright
symbol.</p></li>
</ul>
<p>Docutils has no need of a character entity subsystem.  Supporting
Unicode and text encodings, character entities should be directly
represented in the text: a copyright symbol should be represented by
the copyright symbol character.  If this is not possible in an
authoring environment, a pre-processing stage can be added, or a table
of substitution definitions can be devised.</p>
<p>A “unicode” directive has been implemented to allow direct
specification of esoteric characters.  In combination with the
substitution construct, “include” files defining common sets of
character entities can be defined and used.  <a class="reference external" href="http://docutils.sf.net/tmp/charents/">A set of character
entity set definition files have been defined</a> (<a class="reference external" href="http://docutils.sf.net/tmp/charents.tgz">tarball</a>).
There’s also <a class="reference external" href="http://docutils.sf.net/tmp/charents/README.html">a description and instructions for use</a>.</p>
<p>To allow for <a class="reference external" href="../../ref/rst/restructuredtext.html#character-level-inline-markup">character-level inline markup</a>, a limited form of
character processing has been added to the spec and parser: escaped
whitespace characters are removed from the processed document.  Any
further character processing will be of this functional type, rather
than of the character-encoding type.</p>
<ul>
<li><p>Directive idea:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">text</span><span class="o">-</span><span class="n">replace</span><span class="p">::</span> <span class="s2">&quot;pattern&quot;</span> <span class="s2">&quot;replacement&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Support Unicode “U+XXXX” codes.</p></li>
<li><p>Support regexps, perhaps with alternative “regexp-replace”
directive.</p></li>
<li><p>Flags for regexps; “:flags:” option, or individuals.</p></li>
<li><p>Specifically, should the default be case-sensistive or
-insensitive?</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="page-or-line-breaks">
<h3><a class="toc-backref" href="#id64">Page Or Line Breaks</a><a class="headerlink" href="#page-or-line-breaks" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>Should ^L (or something else in reST) be defined to mean
force/suggest page breaks in whatever output we have?</p>
<p>A “break” or “page-break” directive would be easy to add.  A new
doctree element would be required though (perhaps “break”).  The
final behavior would be up to the Writer.  The directive argument
could be one of page/column/recto/verso for added flexibility.</p>
<p>Currently ^L (Python’s <code class="docutils literal notranslate"><span class="pre">\f</span></code>) characters are treated as whitespace.
They’re converted to single spaces, actually, as are vertical tabs
(^K, Python’s <code class="docutils literal notranslate"><span class="pre">\v</span></code>).  It would be possible to recognize form feeds
as markup, but it requires some thought and discussion first.  Are
there any downsides?  Many editing environments do not allow the
insertion of control characters.  Will it cause any harm?  It would
be useful as a shorthand for the directive.</p>
<p>It’s common practice to use ^L before Emacs “Local Variables”
lists:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">^</span><span class="n">L</span>
<span class="o">..</span>
   <span class="n">Local</span> <span class="n">Variables</span><span class="p">:</span>
   <span class="n">mode</span><span class="p">:</span> <span class="n">indented</span><span class="o">-</span><span class="n">text</span>
   <span class="n">indent</span><span class="o">-</span><span class="n">tabs</span><span class="o">-</span><span class="n">mode</span><span class="p">:</span> <span class="n">nil</span>
   <span class="n">sentence</span><span class="o">-</span><span class="n">end</span><span class="o">-</span><span class="n">double</span><span class="o">-</span><span class="n">space</span><span class="p">:</span> <span class="n">t</span>
   <span class="n">fill</span><span class="o">-</span><span class="n">column</span><span class="p">:</span> <span class="mi">70</span>
   <span class="n">End</span><span class="p">:</span>
</pre></div>
</div>
<p>These are already present in many PEPs and Docutils project
documents.  From the Emacs manual (info):</p>
<blockquote>
<div><p>A “local variables list” goes near the end of the file, in the
last page.  (It is often best to put it on a page by itself.)</p>
</div></blockquote>
<p>It would be unfortunate if this construct caused a final blank page
to be generated (for those Writers that recognize the page breaks).
We’ll have to add a transform that looks for a “break” plus zero or
more comments at the end of a document, and removes them.</p>
<p>Probably a bad idea because there is no such thing as a page in a
generic document format.</p>
</li>
<li><p>Could the “break” concept above be extended to inline forms?
E.g. “^L” in the middle of a sentence could cause a line break.
Only recognize it at the end of a line (i.e., <code class="docutils literal notranslate"><span class="pre">\f\n</span></code>)?</p>
<p>Or is formfeed inappropriate?  Perhaps vertical tab (<code class="docutils literal notranslate"><span class="pre">\v</span></code>), but
even that’s a stretch.  Can’t use carriage returns, since they’re
commonly used for line endings.</p>
<p>Probably a bad idea as well because we do not want to use control
characters for well-readable and well-writable markup, and after all
we have the line block syntax for line breaks.</p>
</li>
</ul>
</div>
<div class="section" id="superscript-markup">
<h3><a class="toc-backref" href="#id65">Superscript Markup</a><a class="headerlink" href="#superscript-markup" title="永久链接至标题">¶</a></h3>
<p>Add <code class="docutils literal notranslate"><span class="pre">^superscript^</span></code> inline markup?  The only common non-markup uses
of “^” I can think of are as short hand for “superscript” itself and
for describing control characters (“^C to cancel”).  The former
supports the proposed syntax, and it could be argued that the latter
ought to be literal text anyhow (e.g. “<code class="docutils literal notranslate"><span class="pre">^C</span></code> to cancel”).</p>
<p>However, superscripts are seldom needed, and new syntax would break
existing documents.  When it’s needed, the <code class="docutils literal notranslate"><span class="pre">:superscript:</span></code>
(<code class="docutils literal notranslate"><span class="pre">:sup:</span></code>) role can we used as well.</p>
</div>
<div class="section" id="code-execution">
<h3><a class="toc-backref" href="#id66">Code Execution</a><a class="headerlink" href="#code-execution" title="永久链接至标题">¶</a></h3>
<p>Add the following directives?</p>
<ul>
<li><p>“exec”: Execute Python code &amp; insert the results.  Call it
“python” to allow for other languages?</p></li>
<li><p>“system”: Execute an <code class="docutils literal notranslate"><span class="pre">os.system()</span></code> call, and insert the results
(possibly as a literal block).  Definitely dangerous!  How to make
it safe?  Perhaps such processing should be left outside of the
document, in the user’s production system (a makefile or a script or
whatever).  Or, the directive could be disabled by default and only
enabled with an explicit command-line option or config file setting.
Even then, an interactive prompt may be useful, such as:</p>
<blockquote>
<div><p>The file.txt document you are processing contains a “system”
directive requesting that the <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">/</span></code> command be
executed.  Allow it to execute?  (y/N)</p>
</div></blockquote>
</li>
<li><p>“eval”: Evaluate an expression &amp; insert the text.  At parse
time or at substitution time?  Dangerous?  Perhaps limit to canned
macros; see <a class="reference external" href="../todo.html#text-date">text.date</a>.</p>
</li>
</ul>
<p>It’s too dangerous (or too complicated in the case of “eval”).  We do
not want to have such things in the core.</p>
</div>
<div class="section" id="encoding-directive">
<h3><a class="toc-backref" href="#id67"><code class="docutils literal notranslate"><span class="pre">encoding</span></code> Directive</a><a class="headerlink" href="#encoding-directive" title="永久链接至标题">¶</a></h3>
<p>Add an “encoding” directive to specify the character encoding of the
input data?  Not a good idea for the following reasons:</p>
<ul class="simple">
<li><p>When it sees the directive, the parser will already have read the
input data, and encoding determination will already have been done.</p></li>
<li><p>If a file with an “encoding” directive is edited and saved with
a different encoding, the directive may cause data corruption.</p></li>
</ul>
</div>
<div class="section" id="support-for-annotations">
<h3><a class="toc-backref" href="#id68">Support for Annotations</a><a class="headerlink" href="#support-for-annotations" title="永久链接至标题">¶</a></h3>
<p>Add an “annotation” role, as the equivalent of the HTML “title”
attribute?  This is secondary information that may “pop up” when the
pointer hovers over the main text.  A corresponding directive would be
required to associate annotations with the original text (by name, or
positionally as in anonymous targets?).</p>
<p>There have not been many requests for such feature, though.  Also,
cluttering WYSIWYG plaintext with annotations may not seem like a good
idea, and there is no “tool tip” in formats other than HTML.</p>
</div>
<div class="section" id="term-role">
<h3><a class="toc-backref" href="#id69"><code class="docutils literal notranslate"><span class="pre">term</span></code> Role</a><a class="headerlink" href="#term-role" title="永久链接至标题">¶</a></h3>
<p>Add a “term” role for unfamiliar or specialized terminology?  Probably
not; there is no real use case, and emphasis is enough for most cases.</p>
</div>
<div class="section" id="object-references">
<h3><a class="toc-backref" href="#id70">Object references</a><a class="headerlink" href="#object-references" title="永久链接至标题">¶</a></h3>
<p>We need syntax for <a class="reference external" href="../todo.html#object-numbering-and-object-references">object references</a>.</p>
<blockquote>
<div><ul>
<li><p>Parameterized substitutions?  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">See</span> <span class="o">|</span><span class="n">figure</span> <span class="p">(</span><span class="n">figure</span> <span class="n">name</span><span class="p">)</span><span class="o">|</span> <span class="n">on</span> <span class="o">|</span><span class="n">page</span> <span class="p">(</span><span class="n">figure</span> <span class="n">name</span><span class="p">)</span><span class="o">|.</span>

<span class="o">..</span> <span class="o">|</span><span class="n">figure</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">|</span> <span class="n">figure</span><span class="o">-</span><span class="n">ref</span><span class="p">::</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="o">..</span> <span class="o">|</span><span class="n">page</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">|</span> <span class="n">page</span><span class="o">-</span><span class="n">ref</span><span class="p">::</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>The result would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">See</span> <span class="n">figure</span> <span class="mf">3.11</span> <span class="n">on</span> <span class="n">page</span> <span class="mf">157.</span>
</pre></div>
</div>
<p>But this would require substitution directives to be processed at
reference-time, not at definition-time as they are now.  Or,
perhaps the directives could just leave <code class="docutils literal notranslate"><span class="pre">pending</span></code> elements
behind, and the transforms do the work?  How to pass the data
through? Too complicated. Use interpreted text roles.</p>
</li>
</ul>
</div></blockquote>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Nosy

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
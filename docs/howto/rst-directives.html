

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>创建 reStructuredText 指令 &mdash; docutils-docs v2019.04.12 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="创建reStructuredText解释的文本角色" href="rst-roles.html" />
    <link rel="prev" title="基本知识" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../contents.html" class="icon icon-home"> docutils-docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Docutils 项目文档概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release/index.html">版本发布</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc.html">文档实用程序</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rst.html">Docutils 的标记语法和解析器组件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">用户文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/index.html">参考文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">Developer Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">基本知识</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">创建 reStructuredText 指令</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-directive-class">指令类</a></li>
<li class="toctree-l3"><a class="reference internal" href="#option-conversion-functions">选项转换功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="#error-handling">错误处理</a></li>
<li class="toctree-l3"><a class="reference internal" href="#register-the-directive">注册指令</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">例子</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#admonitions">忠告</a></li>
<li class="toctree-l4"><a class="reference internal" href="#image">“image”</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-pending-element">待定元素</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rst-roles.html">创建reStructuredText解释的文本角色</a></li>
<li class="toctree-l2"><a class="reference internal" href="html-stylesheets.html">Writing HTML (CSS) Stylesheets for Docutils</a></li>
<li class="toctree-l2"><a class="reference internal" href="i18n.html">Docutils Internationalization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../contents.html">docutils-docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">基本知识</a> &raquo;</li>
        
      <li>创建 reStructuredText 指令</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/howto/rst-directives.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="creating-restructuredtext-directives">
<h1>创建 <a class="reference internal" href="#restructuredtext">reStructuredText</a> 指令<a class="headerlink" href="#creating-restructuredtext-directives" title="永久链接至标题">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Authors</dt>
<dd class="field-odd"><p>Dethe Elza, David Goodger, Lea Wiemann</p>
</dd>
<dt class="field-even">Contact</dt>
<dd class="field-even"><p><a class="reference external" href="mailto:docutils-develop&#37;&#52;&#48;lists&#46;sourceforge&#46;net">docutils-develop<span>&#64;</span>lists<span>&#46;</span>sourceforge<span>&#46;</span>net</a></p>
</dd>
<dt class="field-odd">Date</dt>
<dd class="field-odd"><p>$Date: 2012-01-03 20:23:53 +0100 (Di, 03. J盲n 2012) $</p>
</dd>
<dt class="field-even">Revision</dt>
<dd class="field-even"><p>$Revision: 7302 $</p>
</dd>
<dt class="field-odd">Copyright</dt>
<dd class="field-odd"><p>本文档已置于公共领域。</p>
</dd>
</dl>
<p>Directives are the primary extension mechanism of reStructuredText.
This document aims to make the creation of new directives as easy and
understandable as possible.  There are only a couple of
reStructuredText-specific features the developer needs to know to
create a basic directive.</p>
<p>The syntax of directives is detailed in the <a class="reference external" href="../ref/rst/restructuredtext.html#directives">reStructuredText Markup
Specification</a>, and standard directives are described in
<a class="reference external" href="../ref/rst/directives.html">reStructuredText Directives</a>.</p>
<p>Directives are a reStructuredText markup/parser concept.  There is no
“directive” document tree element, no single element that corresponds
exactly to the concept of directives.  Instead, choose the most
appropriate elements from the existing Docutils elements.  Directives
build structures using the existing building blocks.  See <a class="reference external" href="../ref/doctree.html">The
Docutils Document Tree</a> and the <code class="docutils literal notranslate"><span class="pre">docutils.nodes</span></code> module for more
about the building blocks of Docutils documents.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#creating-restructuredtext-directives" id="id4">创建 reStructuredText 指令</a></p>
<ul>
<li><p><a class="reference internal" href="#the-directive-class" id="id5">指令类</a></p></li>
<li><p><a class="reference internal" href="#option-conversion-functions" id="id6">选项转换功能</a></p></li>
<li><p><a class="reference internal" href="#error-handling" id="id7">错误处理</a></p></li>
<li><p><a class="reference internal" href="#register-the-directive" id="id8">注册指令</a></p></li>
<li><p><a class="reference internal" href="#examples" id="id9">例子</a></p>
<ul>
<li><p><a class="reference internal" href="#admonitions" id="id10">忠告</a></p></li>
<li><p><a class="reference internal" href="#image" id="id11">“image”</a></p></li>
<li><p><a class="reference internal" href="#the-pending-element" id="id12">待定元素</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="the-directive-class">
<h2><a class="toc-backref" href="#id5">指令类</a><a class="headerlink" href="#the-directive-class" title="永久链接至标题">¶</a></h2>
<p>Directives are created by defining a directive class that inherits
from <code class="docutils literal notranslate"><span class="pre">docutils.parsers.rst.Directive</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docutils.parsers</span> <span class="k">import</span> <span class="n">rst</span>

<span class="k">class</span> <span class="nc">MyDirective</span><span class="p">(</span><span class="n">rst</span><span class="o">.</span><span class="n">Directive</span><span class="p">):</span>

    <span class="o">...</span>
</pre></div>
</div>
<p>To understand how to implement the directive, let’s have a look at the
docstring of the <code class="docutils literal notranslate"><span class="pre">Directive</span></code> base class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">docutils.parsers</span> <span class="k">import</span> <span class="n">rst</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">rst</span><span class="o">.</span><span class="n">Directive</span><span class="o">.</span><span class="vm">__doc__</span>

<span class="go">    Base class for reStructuredText directives.</span>

<span class="go">    The following attributes may be set by subclasses.  They are</span>
<span class="go">    interpreted by the directive parser (which runs the directive</span>
<span class="go">    class):</span>

<span class="go">    - `required_arguments`: The number of required arguments (default:</span>
<span class="go">      0).</span>

<span class="go">    - `optional_arguments`: The number of optional arguments (default:</span>
<span class="go">      0).</span>

<span class="go">    - `final_argument_whitespace`: A boolean, indicating if the final</span>
<span class="go">      argument may contain whitespace (default: False).</span>

<span class="go">    - `option_spec`: A dictionary, mapping known option names to</span>
<span class="go">      conversion functions such as `int` or `float` (default: {}, no</span>
<span class="go">      options).  Several conversion functions are defined in the</span>
<span class="go">      directives/__init__.py module.</span>

<span class="go">      Option conversion functions take a single parameter, the option</span>
<span class="go">      argument (a string or ``None``), validate it and/or convert it</span>
<span class="go">      to the appropriate form.  Conversion functions may raise</span>
<span class="go">      `ValueError` and `TypeError` exceptions.</span>

<span class="go">    - `has_content`: A boolean; True if content is allowed.  Client</span>
<span class="go">      code must handle the case where content is required but not</span>
<span class="go">      supplied (an empty content list will be supplied).</span>

<span class="go">    Arguments are normally single whitespace-separated words.  The</span>
<span class="go">    final argument may contain whitespace and/or newlines if</span>
<span class="go">    `final_argument_whitespace` is True.</span>

<span class="go">    If the form of the arguments is more complex, specify only one</span>
<span class="go">    argument (either required or optional) and set</span>
<span class="go">    `final_argument_whitespace` to True; the client code must do any</span>
<span class="go">    context-sensitive parsing.</span>

<span class="go">    When a directive implementation is being run, the directive class</span>
<span class="go">    is instantiated, and the `run()` method is executed.  During</span>
<span class="go">    instantiation, the following instance variables are set:</span>

<span class="go">    - ``name`` is the directive type or name (string).</span>

<span class="go">    - ``arguments`` is the list of positional arguments (strings).</span>

<span class="go">    - ``options`` is a dictionary mapping option names (strings) to</span>
<span class="go">      values (type depends on option conversion functions; see</span>
<span class="go">      `option_spec` above).</span>

<span class="go">    - ``content`` is a list of strings, the directive content line by line.</span>

<span class="go">    - ``lineno`` is the line number of the first line of the directive.</span>

<span class="go">    - ``content_offset`` is the line offset of the first line of the content from</span>
<span class="go">      the beginning of the current input.  Used when initiating a nested parse.</span>

<span class="go">    - ``block_text`` is a string containing the entire directive.</span>

<span class="go">    - ``state`` is the state which called the directive function.</span>

<span class="go">    - ``state_machine`` is the state machine which controls the state which called</span>
<span class="go">      the directive function.</span>

<span class="go">    Directive functions return a list of nodes which will be inserted</span>
<span class="go">    into the document tree at the point where the directive was</span>
<span class="go">    encountered.  This can be an empty list if there is nothing to</span>
<span class="go">    insert.</span>

<span class="go">    For ordinary directives, the list must contain body elements or</span>
<span class="go">    structural elements.  Some directives are intended specifically</span>
<span class="go">    for substitution definitions, and must return a list of `Text`</span>
<span class="go">    nodes and/or inline elements (suitable for inline insertion, in</span>
<span class="go">    place of the substitution reference).  Such directives must verify</span>
<span class="go">    substitution definition context, typically using code like this::</span>

<span class="go">        if not isinstance(state, states.SubstitutionDef):</span>
<span class="go">            error = state_machine.reporter.error(</span>
<span class="go">                &#39;Invalid context: the &quot;%s&quot; directive can only be used &#39;</span>
<span class="go">                &#39;within a substitution definition.&#39; % (name),</span>
<span class="go">                nodes.literal_block(block_text, block_text), line=lineno)</span>
<span class="go">            return [error]</span>

<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="option-conversion-functions">
<h2><a class="toc-backref" href="#id6">选项转换功能</a><a class="headerlink" href="#option-conversion-functions" title="永久链接至标题">¶</a></h2>
<p>An option specification (<code class="docutils literal notranslate"><span class="pre">Directive.option_spec</span></code>) must be defined
detailing the options available to the directive.  An option spec is a
mapping of option name to conversion function; conversion functions
are applied to each option value to check validity and convert them to
the expected type.  Python’s built-in conversion functions are often
usable for this, such as <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>.  Other useful conversion
functions are included in the <code class="docutils literal notranslate"><span class="pre">docutils.parsers.rst.directives</span></code>
package (in the <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> module):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flag</span></code>: For options with no option arguments.  Checks for an
argument (raises <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if found), returns <code class="docutils literal notranslate"><span class="pre">None</span></code> for
valid flag options.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unchanged_required</span></code>: Returns the text argument, unchanged.
Raises <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if no argument is found.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unchanged</span></code>: Returns the text argument, unchanged.  Returns an
empty string (“”) if no argument is found.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: Returns the path argument unwrapped (with newlines
removed).  Raises <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if no argument is found.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uri</span></code>: Returns the URI argument with whitespace removed.  Raises
<code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if no argument is found.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nonnegative_int</span></code>: Checks for a nonnegative integer argument,
and raises <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if not.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">class_option</span></code>: Converts the argument into an ID-compatible
string and returns it.  Raises <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if no argument is
found.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unicode_code</span></code>: 将Unicode字符代码转换为Unicode字符。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">single_char_or_unicode</span></code>: A single character is returned as-is.
Unicode characters codes are converted as in <code class="docutils literal notranslate"><span class="pre">unicode_code</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">single_char_or_whitespace_or_unicode</span></code>: As with
<code class="docutils literal notranslate"><span class="pre">single_char_or_unicode</span></code>, but “tab” and “space” are also
supported.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">positive_int</span></code>: Converts the argument into an integer.  Raises
ValueError for negative, zero, or non-integer values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">positive_int_list</span></code>: Converts a space- or comma-separated list
of integers into a Python list of integers.  Raises ValueError for
non-positive-integer values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">encoding</span></code>: Verfies the encoding argument by lookup.  Raises
ValueError for unknown encodings.</p></li>
</ul>
<p>A further utility function, <code class="docutils literal notranslate"><span class="pre">choice</span></code>, is supplied to enable
options whose argument must be a member of a finite set of possible
values.  A custom conversion function must be written to use it.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="k">import</span> <span class="n">directives</span>

<span class="k">def</span> <span class="nf">yesno</span><span class="p">(</span><span class="n">argument</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">directives</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>For example, here is an option spec for a directive which allows two
options, “name” and “value”, each with an option argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option_spec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">unchanged</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="error-handling">
<h2><a class="toc-backref" href="#id7">错误处理</a><a class="headerlink" href="#error-handling" title="永久链接至标题">¶</a></h2>
<p>If your directive implementation encounters an error during
processing, you should call <code class="docutils literal notranslate"><span class="pre">self.error()</span></code> inside the <code class="docutils literal notranslate"><span class="pre">run()</span></code>
method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">error_condition</span><span class="p">:</span>
    <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error message.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">self.error()</span></code> method will immediately raise an exception that
will be caught by the reStructuredText directive handler.  The
directive handler will then insert an error-level system message in
the document at the place where the directive occurred.</p>
<p>Instead of <code class="docutils literal notranslate"><span class="pre">self.error</span></code>, you can also use <code class="docutils literal notranslate"><span class="pre">self.severe</span></code> and
<code class="docutils literal notranslate"><span class="pre">self.warning</span></code> for more or less severe problems.</p>
<p>If you want to return a system message <em>and</em> document contents, you need to
create the system message yourself instead of using the <code class="docutils literal notranslate"><span class="pre">self.error</span></code>
convenience method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Create node(s).</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="c1"># Node list to return.</span>
    <span class="n">node_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">error_condition</span><span class="p">:</span>
         <span class="c1"># Create system message.</span>
         <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
             <span class="s1">&#39;Error in &quot;</span><span class="si">%s</span><span class="s1">&quot; directive: Your error message.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
             <span class="n">nodes</span><span class="o">.</span><span class="n">literal_block</span><span class="p">(</span><span class="n">block_text</span><span class="p">,</span> <span class="n">block_text</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
         <span class="n">node_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">node_list</span>
</pre></div>
</div>
</div>
<div class="section" id="register-the-directive">
<h2><a class="toc-backref" href="#id8">注册指令</a><a class="headerlink" href="#register-the-directive" title="永久链接至标题">¶</a></h2>
<ul>
<li><p>If the directive is a general-use <strong>addition to the Docutils core</strong>,
it must be registered with the parser and language mappings added:</p>
<ol class="arabic simple">
<li><p>Register the new directive using its canonical name in
<code class="docutils literal notranslate"><span class="pre">docutils/parsers/rst/directives/__init__.py</span></code>, in the
<code class="docutils literal notranslate"><span class="pre">_directive_registry</span></code> dictionary.  This allows the
reStructuredText parser to find and use the directive.</p></li>
<li><p>Add an entry to the <code class="docutils literal notranslate"><span class="pre">directives</span></code> dictionary in
<code class="docutils literal notranslate"><span class="pre">docutils/parsers/rst/languages/en.py</span></code> for the directive, mapping
the English name to the canonical name (both lowercase).  Usually
the English name and the canonical name are the same.</p></li>
<li><p>Update all the other language modules as well.  For languages in
which you are proficient, please add translations.  For other
languages, add the English directive name plus “(translation
required)”.</p></li>
</ol>
</li>
<li><p>If the directive is <strong>application-specific</strong>, use the
<code class="docutils literal notranslate"><span class="pre">register_directive</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="k">import</span> <span class="n">directives</span>
<span class="n">directives</span><span class="o">.</span><span class="n">register_directive</span><span class="p">(</span><span class="n">directive_name</span><span class="p">,</span> <span class="n">directive_class</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="examples">
<h2><a class="toc-backref" href="#id9">例子</a><a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h2>
<p>For the most direct and accurate information, “Use the Source, Luke!”.
All standard directives are documented in <a class="reference external" href="../ref/rst/directives.html">reStructuredText
Directives</a>, and the source code implementing them is located in the
<code class="docutils literal notranslate"><span class="pre">docutils/parsers/rst/directives</span></code> package.  The <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>
module contains a mapping of directive name to module and function
name.  Several representative directives are described below.</p>
<div class="section" id="admonitions">
<h3><a class="toc-backref" href="#id10">忠告</a><a class="headerlink" href="#admonitions" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="../ref/rst/directives.html#specific-admonitions">Admonition directives</a>, such as “note” and “caution”, are quite
simple.  They have no directive arguments or options.  Admonition
directive content is interpreted as ordinary reStructuredText.</p>
<p>The resulting document tree for a simple reStructuredText line
“<code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">note::</span> <span class="pre">This</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">note.</span></code>” looks as follows:</p>
<blockquote>
<div><dl class="simple">
<dt>&lt;note&gt;</dt><dd><dl class="simple">
<dt>&lt;paragraph&gt;</dt><dd><p>这是一张纸条。</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>The directive class for the “note” directive simply derives from a
generic admonition directive class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Note</span><span class="p">(</span><span class="n">BaseAdmonition</span><span class="p">):</span>

    <span class="n">node_class</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">note</span>
</pre></div>
</div>
<p>Note that the only thing distinguishing the various admonition
directives is the element (node class) generated.  In the code above,
the node class is set as a class attribute and is read by the
<code class="docutils literal notranslate"><span class="pre">run()</span></code> method of <code class="docutils literal notranslate"><span class="pre">BaseAdmonition</span></code>, where the actual processing
takes place:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import Docutils document tree nodes module.</span>
<span class="kn">from</span> <span class="nn">docutils</span> <span class="k">import</span> <span class="n">nodes</span>
<span class="c1"># Import Directive base class.</span>
<span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="k">import</span> <span class="n">Directive</span>

<span class="k">class</span> <span class="nc">BaseAdmonition</span><span class="p">(</span><span class="n">Directive</span><span class="p">):</span>

    <span class="n">required_arguments</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">optional_arguments</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">final_argument_whitespace</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">option_spec</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">has_content</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">node_class</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;Subclasses must set this to the appropriate admonition node class.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Raise an error if the directive does not have contents.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_has_content</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="c1"># Create the admonition node, to be populated by `nested_parse`.</span>
        <span class="n">admonition_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_class</span><span class="p">(</span><span class="n">rawsource</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
        <span class="c1"># Parse the directive contents.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">nested_parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_offset</span><span class="p">,</span>
                                <span class="n">admonition_node</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">admonition_node</span><span class="p">]</span>
</pre></div>
</div>
<p>Three things are noteworthy in the <code class="docutils literal notranslate"><span class="pre">run()</span></code> method above:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">admonition_node</span> <span class="pre">=</span> <span class="pre">self.node_class(text)</span></code> line creates the
wrapper element, using the class set by the specific admonition
subclasses (as in note, <code class="docutils literal notranslate"><span class="pre">node_class</span> <span class="pre">=</span> <span class="pre">nodes.note</span></code>).</p></li>
<li><p>The call to <code class="docutils literal notranslate"><span class="pre">state.nested_parse()</span></code> is what does the actual
processing.  It parses the directive content and adds any generated
elements as child elements of <code class="docutils literal notranslate"><span class="pre">admonition_node</span></code>.</p></li>
<li><p>If there was no directive content, the <code class="docutils literal notranslate"><span class="pre">assert_has_content()</span></code>
convenience method raises an error exception by calling
<code class="docutils literal notranslate"><span class="pre">self.error()</span></code> (see <a class="reference internal" href="#error-handling">Error Handling</a> above).</p></li>
</ul>
</div>
<div class="section" id="image">
<h3><a class="toc-backref" href="#id11">“image”</a><a class="headerlink" href="#image" title="永久链接至标题">¶</a></h3>
<p>The “<a class="reference external" href="../ref/rst/directives.html#image">image</a>” directive is used to insert a picture into a document.
This directive has one argument, the path to the image file, and
supports several options.  There is no directive content.  Here’s an
early version of the image directive class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import Docutils document tree nodes module.</span>
<span class="kn">from</span> <span class="nn">docutils</span> <span class="k">import</span> <span class="n">nodes</span>
<span class="c1"># Import ``directives`` module (contains conversion functions).</span>
<span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="k">import</span> <span class="n">directives</span>
<span class="c1"># Import Directive base class.</span>
<span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="k">import</span> <span class="n">Directive</span>

<span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="n">argument</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Conversion function for the &quot;align&quot; option.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">directives</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Image</span><span class="p">(</span><span class="n">Directive</span><span class="p">):</span>

    <span class="n">required_arguments</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">optional_arguments</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">final_argument_whitespace</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">option_spec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alt&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
                   <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">nonnegative_int</span><span class="p">,</span>
                   <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">nonnegative_int</span><span class="p">,</span>
                   <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">nonnegative_int</span><span class="p">,</span>
                   <span class="s1">&#39;align&#39;</span><span class="p">:</span> <span class="n">align</span><span class="p">,</span>
                   <span class="p">}</span>
    <span class="n">has_content</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="n">directives</span><span class="o">.</span><span class="n">uri</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;uri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reference</span>
        <span class="n">image_node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">rawsource</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">block_text</span><span class="p">,</span>
                                 <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">image_node</span><span class="p">]</span>
</pre></div>
</div>
<p>上面的代码中有几点值得注意:</p>
<ul class="simple">
<li><p>The “image” directive requires a single argument, which is allowed
to contain whitespace (<code class="docutils literal notranslate"><span class="pre">final_argument_whitespace</span> <span class="pre">=</span> <span class="pre">True</span></code>).  This
is to allow for long URLs which may span multiple lines.  The first
line of the <code class="docutils literal notranslate"><span class="pre">run()</span></code> method joins the URL, discarding any embedded
whitespace.</p></li>
<li><p>The reference is added to the <code class="docutils literal notranslate"><span class="pre">options</span></code> dictionary under the
“uri” key; this becomes an attribute of the <code class="docutils literal notranslate"><span class="pre">nodes.image</span></code> element
object.  Any other attributes have already been set explicitly in
the reStructuredText source text.</p></li>
</ul>
</div>
<div class="section" id="the-pending-element">
<h3><a class="toc-backref" href="#id12">待定元素</a><a class="headerlink" href="#the-pending-element" title="永久链接至标题">¶</a></h3>
<p>Directives that cause actions to be performed <em>after</em> the complete
document tree has been generated can be implemented using a
<code class="docutils literal notranslate"><span class="pre">pending</span></code> node.  The <code class="docutils literal notranslate"><span class="pre">pending</span></code> node causes a <a class="reference external" href="../ref/transforms.html">transform</a> to be run
after the document has been parsed.</p>
<p>有关 <code class="docutils literal notranslate"><span class="pre">pending</span></code> 节点的示例用法，请参阅 <a class="reference external" href="http://docutils.sf.net/docutils/parsers/rst/directives/parts.py">docutils.parsers.rst.directives.parts</a> 中 <code class="docutils literal notranslate"><span class="pre">contents</span></code> 指令的实现。</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rst-roles.html" class="btn btn-neutral float-right" title="创建reStructuredText解释的文本角色" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="基本知识" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Nosy

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>